<script src="https://detroitmi.gov/core/assets/vendor/jquery/jquery.min.js?v=3.2.1"></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700,900" rel="stylesheet">
<script src='https://api.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.js'></script>
<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css' rel='stylesheet' />
<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/terraformer/1.0.8/terraformer.min.js'></script>
<script src='https://unpkg.com/terraformer-wkt-parser@1.1.2/terraformer-wkt-parser.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.css' type='text/css' />
<style>
    @import url('https://fonts.googleapis.com/css?family=Montserrat:300,700,900');
    body {
        font-family: 'Montserrat';
    }
    
    .red-portal .title-icon img {
        width: 4em;
        margin-right: 1em;
        margin-top: -1em;
    }
    
    .red-portal .subtitle-icon img {
        width: 3em;
        margin-right: 1em;
        display: inline-block;
        vertical-align: text-bottom;
    }
    
    .red-portal .subcontent h5 {
        margin-top: 1em;
    }
    
    .red-portal h3 {
        margin-bottom: 0.7em;
        line-height: 1em;
    }
    
    .red-portal::selection {
        background: #feb70d;
    }
    
    .red-portal a {
        text-decoration: none;
        font-weight: 600;
    }
    
    #map {
        height: 73.25vh;
        grid-area: map;
    }
    
    #filters-toggle {
        position: absolute;
        z-index: 105;
        margin: 0.8em;
        padding: 0.85em;
        font-size: 12px;
        font-family: 'Montserrat';
        background: #279989;
        border: 2px solid #18252a;
        color: white;
        font-weight: 600;
    }
    
    #filters-toggle:hover {
        background: #003B49;
    }
    
    .mapboxgl-ctrl-geocoder.mapboxgl-ctrl {
        border: 2px solid #18252a;
        font-family: 'Montserrat';
        box-shadow: none;
        border-radius: 0px;
        font-weight: 600;
    }
    
    .mapboxgl-ctrl-geocoder input:focus {
        color: #424e54;
    }
    
    #map-filters {
        display: none;
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        z-index: 100;
        overflow-y: scroll;
        overflow-x: hidden;
        height: 73.5vh;
        bottom: 0px;
        left: 0px;
        padding: 6em 2em;
        width: 100%;
    }
    
    #map-filters .category {
        font-size: 1.4em !important;
        text-decoration: underline;
    }
    
    #map-filters .subcategory {
        margin: 1em;
    }
    
    #map-filters .subcategory,
    #map-filters .zoning-subcategory {
        display: inline-block;
        vertical-align: top;
    }
    
    #map-filters .zoning-subcategory {
        margin-left: 3.75em;
    }
    
    #map-filters label {
        font-size: 1.25em;
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
    }
    
    #map-filters>ul {
        margin-top: 20px;
    }
    
    #map-sidebar {
        height: 70vh;
        background: white;
        float: right;
        overflow-y: scroll;
        padding: 1em;
        grid-area: info;
    }
    
    .disclaimer {
        font-weight: 700;
    }
    
    #map-sidebar-info,
    #glossary {
        padding: 1em 0em;
    }
    
    #map-sidebar-info hr {
        margin: 0.5em auto;
    }
    
    #map-sidebar-info h5 {
        position: relative;
        z-index: 1;
        text-align: center;
        margin: 1em auto 0.25em auto;
        font-weight: 700;
    }
    
    #map-sidebar-info h5:before {
        border-top: 2px solid #003B49;
        content: "";
        margin: 0 auto;
        /* this centers the line to the full width specified */
        position: absolute;
        /* positioning must be absolute here, and relative positioning must be applied to the parent */
        top: 10px;
        left: 0;
        right: 0;
        bottom: 0;
        width: 95%;
        z-index: -1;
    }
    
    #map-sidebar-info h5 span {
        /* to hide the lines from behind the text, you have to set the background color the same as the container */
        background: #fff;
        padding: 0 5px;
    }
    
    #map-sidebar-info p {
        font-size: 0.9em;
        line-height: 1.2em;
        margin-bottom: 0.35em;
    }
    
    #map-sidebar-info p.mc-business {
        text-transform: uppercase;
        font-weight: 700;
        font-size: 0.96em;
    }
    
    #map-sidebar-info p.mc-business-address {
        font-size: 0.75em;
        margin-top: -5px;
        margin-bottom: 10px;
    }
    
    a.mc-business-link {
        font-weight: 700;
    }
    
    #glossary {
        display: none;
    }
    
    #glossary p.public-assets-header {
        font-weight: bold;
        text-decoration: underline;
    }
    
    #public-ownership-count>span,
    #development-count>span,
    #retail-count>span {
        text-decoration: underline;
    }
    
    #public-ownership-count p,
    #development-count p,
    #retail-count p {
        margin-left: 1em;
    }
    
    #planning-label,
    #public-transportation-label,
    #zoning-label {
        margin: 2em 0.5rem;
    }
    
    #zoning-label {
        width: 90%;
        position: relative;
    }
    
    #development-label {
        margin: 2em 0em 0em 0.5rem;
    }
    
    #public-transportation-list,
    #planning-area-list {
        margin-left: 3.75em;
    }
    
    #tab-buttons {
        background: rgb(214, 214, 214);
        margin: -1em -1em 0em -1em;
        padding: 0.8em 0em;
    }
    
    .tab-button {
        padding: 0.3em;
        cursor: pointer;
        font-weight: 900;
        letter-spacing: 3px;
    }
    
    .tab-button.active {
        cursor: default;
        background: white;
        padding: 1.1em;
    }
    
    #map-sidebar-info p.project-description {
        font-size: 0.85em;
    }
    
    #map-sidebar-info p.occupancy {
        margin: 1em 0;
    }
    
    #map-sidebar-info span.occupancy-status-color {
        width: 15px;
        height: 15px;
        display: inline-block;
        border-radius: 50%;
        vertical-align: text-bottom;
    }
    
    #map-sidebar-info span.occupancy-status {
        display: inline-block;
        margin-left: 0.5em;
    }
    
    #map-sidebar-info p.occupancy svg {
        width: 20px;
        vertical-align: middle;
        margin-left: 3px;
    }
    
    #map-container {
        display: grid;
        grid-template-columns: 2fr 8fr 2fr;
        grid-template-areas: "legend map info";
    }
    
    #map-container>div {
        display: inline-block;
    }
    
    .frame {
        max-height: 250px;
        overflow: hidden;
    }
    
    .frame.project-image {
        margin: 1em 0;
    }
    
    .frame img {
        position: relative;
        margin-top: -10%;
        width: 100%;
    }
    
    .frame.project-image img {
        position: relative;
        width: 100%;
    }
    
    span.field-label {
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .property-app-link {
        background: #279989;
        width: 100%;
        padding: 0.5em;
        text-align: center;
        display: inline-block;
        border: 2px solid #424e54;
        margin-bottom: 1em;
    }
    
    a.property-app-link {
        color: white;
        font-weight: 600;
        min-width: 215px;
    }
    
    .property-app-link:hover {
        background: #003B49/*#424e54*/
        ;
        color: #fefefe;
    }
    
    #loadscreen {
        position: relative;
        top: 50%;
        display: none;
    }
    
    #loadscreen>p {
        position: relative;
        top: 52%;
        text-align: center;
    }
    
    .loading {
        -moz-animation: loading 8s cubic-bezier(0.680, -0.550, 0.265, 1.550) infinite;
        -webkit-animation: loading 8s cubic-bezier(0.680, -0.550, 0.265, 1.550) infinite;
        animation: loading 8s cubic-bezier(0.680, -0.550, 0.265, 1.550) infinite;
    }
    
    .loading,
    .loading:before,
    .loading:after {
        background: #cb0e12;
        box-sizing: border-box;
        display: block;
        font: 0/0 a;
        height: 40px;
        left: 50%;
        margin: -20px 0 0 -5px;
        position: relative;
        top: 50%;
        width: 8px;
    }
    
    .loading:before,
    .loading:after {
        content: '';
        display: block;
        position: absolute;
        -webkit-transform: rotate(0deg);
        left: -10px
    }
    
    .loading:after {
        left: auto;
        right: -15px;
    }
    
    @-moz-keyframes 'loading' {
        0% {
            -moz-transform: rotate(0deg);
        }
        7.5% {
            -moz-transform: rotate(0deg);
        }
        12.5% {
            -moz-transform: rotate(90deg);
        }
        20% {
            -moz-transform: rotate(90deg);
        }
        25% {
            -moz-transform: rotate(180deg);
        }
        32.5% {
            -moz-transform: rotate(180deg);
        }
        37.5% {
            -moz-transform: rotate(270deg);
        }
        45% {
            -moz-transform: rotate(270deg);
        }
        50% {
            -moz-transform: rotate(180deg);
        }
        57.5% {
            -moz-transform: rotate(180deg);
        }
        62.5% {
            -moz-transform: rotate(270deg);
        }
        70% {
            -moz-transform: rotate(270deg);
        }
        75% {
            -moz-transform: rotate(360deg);
        }
        82.5% {
            -moz-transform: rotate(360deg);
        }
        87.5% {
            -moz-transform: rotate(270deg);
        }
        95% {
            -moz-transform: rotate(270deg);
        }
        100% {
            -moz-transform: rotate(360deg);
        }
    }
    
    @-webkit-keyframes 'loading' {
        0% {
            -webkit-transform: rotate(0deg);
        }
        7.5% {
            -webkit-transform: rotate(0deg);
        }
        12.5% {
            -webkit-transform: rotate(90deg);
        }
        20% {
            -webkit-transform: rotate(90deg);
        }
        25% {
            -webkit-transform: rotate(180deg);
        }
        32.5% {
            -webkit-transform: rotate(180deg);
        }
        37.5% {
            -webkit-transform: rotate(270deg);
        }
        45% {
            -webkit-transform: rotate(270deg);
        }
        50% {
            -webkit-transform: rotate(180deg);
        }
        57.5% {
            -webkit-transform: rotate(180deg);
        }
        62.5% {
            -webkit-transform: rotate(270deg);
        }
        70% {
            -webkit-transform: rotate(270deg);
        }
        75% {
            -webkit-transform: rotate(360deg);
        }
        82.5% {
            -webkit-transform: rotate(360deg);
        }
        87.5% {
            -webkit-transform: rotate(270deg);
        }
        95% {
            -webkit-transform: rotate(270deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }
    
    @keyframes 'loading' {
        0% {
            transform: rotate(0deg);
        }
        7.5% {
            transform: rotate(0deg);
        }
        12.5% {
            transform: rotate(90deg);
        }
        20% {
            transform: rotate(90deg);
        }
        25% {
            transform: rotate(180deg);
        }
        32.5% {
            transform: rotate(180deg);
        }
        37.5% {
            transform: rotate(270deg);
        }
        45% {
            transform: rotate(270deg);
        }
        50% {
            transform: rotate(180deg);
        }
        57.5% {
            transform: rotate(180deg);
        }
        62.5% {
            transform: rotate(270deg);
        }
        70% {
            transform: rotate(270deg);
        }
        75% {
            transform: rotate(360deg);
        }
        82.5% {
            transform: rotate(360deg);
        }
        87.5% {
            transform: rotate(270deg);
        }
        95% {
            transform: rotate(270deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
    
    #map-filters ul {
        list-style: none;
        padding: 0;
    }
    
    #map-filters ul .inner {
        padding-left: 1em;
        overflow: hidden;
        display: none;
    }
    
    #map-filters ul .inner.show {
        /*display: block;*/
    }
    
    #map-filters ul li {
        margin: -5px;
    }
    
    #map-filters ul li a.toggle {
        width: 100%;
        display: block;
        background: rgba(0, 0, 0, 0.78);
        color: #fefefe;
        padding: .75em;
        border-radius: 0.15em;
        transition: background .3s ease;
    }
    
    #map-filters ul li a.toggle:hover {
        background: rgba(0, 0, 0, 0.9);
    }
    /*--Legend Styles--*/
    
    #legend {
        background: rgb(250, 250, 250);
        padding: 1em;
        height: 70vh;
        overflow-y: scroll;
        float: left;
        grid-area: legend;
    }
    
    #legend>div {
        margin-left: 1em;
    }
    
    #legend ul {
        margin-left: 0em;
    }
    
    #legend ul li {
        display: inline-block;
        list-style-type: none;
        margin: auto 1em;
    }
    
    #legend span {
        width: 0.75em;
        height: 0.75em;
        display: inline-block;
        margin-right: 0.5em;
    }
    
    #legend span.circle {
        border-radius: 50%;
    }
    
    #legend span.square {
        width: 1em;
    }
    
    #legend span.line {
        width: 1em;
        height: 0.1em;
        vertical-align: middle;
    }
    
    #legend ul.zoning-list-legend {
        margin-bottom: 0em;
    }
    
    #legend span#B1-legend {
        border: 3px solid #b16776;
    }
    
    #legend span#B2-legend {
        border: 3px solid #ca5572;
    }
    
    #legend span#B3-legend {
        border: 3px solid #e2396f;
    }
    
    #legend span#B4-legend {
        border: 3px solid #aa0044;
    }
    
    #legend span#B5-legend {
        border: 3px solid #952347;
    }
    
    #legend span#B6-legend {
        border: 3px solid #74001e;
    }
    
    #legend span#M1-legend {
        border: 3px solid #986eac;
    }
    
    #legend span#M2-legend {
        border: 3px solid #a265c2;
    }
    
    #legend span#M3-legend {
        border: 3px solid #ab5ad8;
    }
    
    #legend span#M4-legend {
        border: 3px solid #713891;
    }
    
    #legend span#M5-legend,
    #legend span#M6-legend {
        border: 3px solid #792aa6;
    }
    
    #legend span#R1-legend {
        border: 3px solid #8195ae;
    }
    
    #legend span#R2-legend {
        border: 3px solid #6097ce;
    }
    
    #legend span#R3-legend {
        border: 3px solid #009aee;
    }
    
    #legend span#R4-legend {
        border: 3px solid #006cbb;
    }
    
    #legend span#R5-legend {
        border: 3px solid #29699d;
    }
    
    #legend span#R6-legend {
        border: 3px solid #00428a;
    }
    
    #legend span#P1-legend,
    #legend span#PC-legend,
    #legend span#PCA-legend,
    #legend span#PD-legend,
    #legend span#PR-legend {
        border: 3px solid #72a553;
    }
    
    #legend span#SD1-legend,
    #legend span#SD2-legend,
    #legend span#SD3-legend,
    #legend span#SD4-legend,
    #legend span#SD5-legend,
    #legend span#SD6-legend,
    #legend span#TM-legend,
    #legend span#W1-legend {
        border: 3px solid #c57c3d;
    }
    
    #legend span#permits-legend {
        background: #b16776;
    }
    
    #legend span#one-million-permits-legend {
        background: #b16776;
    }
    
    #legend span#over-one-million-permits-legend {
        background: #ca5572;
    }
    
    #legend span#peoplemover-legend {
        background: #2c5490;
    }
    
    #legend span#ddot-bus-legend {
        background: #004736;
    }
    
    #legend span#smart-bus-legend {
        background: #d70000;
    }
    
    #legend span#mogobikes-legend {
        background: #ee382a;
    }
    
    #legend span#qline-route-legend {
        width: 2.3em;
        margin-right: 0em;
    }
    
    #legend span#qline-circle-legend {
        background: #d64e34;
        margin: 0em;
        vertical-align: middle;
    }
    
    #legend span#qline-line-legend {
        background: #7fb6ab;
    }
    
    #legend span#motor-city-match-businesses-legend {
        background: #d26e03;
    }
    
    #legend span#motor-city-restore-legend {
        background: #004445;
    }
    
    #legend span#city-owned-for-sale-legend {
        background: #55d5c5;
    }
    
    #legend span#city-owned-legend {
        background: #279989;
    }
    
    #legend span#parks-legend {
        background: rgb(119, 202, 119);
    }
    
    #legend span#vacant-multi-legend {
        background: #f44289;
        border: 1px solid #a5295b;
    }
    
    #legend span#open-rfp-legend {
        background: #ff68ff;
        border: 1px solid #c56bc5;
    }
    
    #legend span#in-construction-rfp-legend {
        background: #b94dba;
        border: 1px solid #b81aba;
    }
    
    #legend span#predevelopment-rfp-legend {
        background: #933c94;
        border: 1px solid #5f0b60;
    }
    
    #legend span#completed-rfp-legend {
        background: #643265;
        border: 1px solid #5f0b60;
    }
    
    #legend span#snf-areas-legend {
        background: #ffff73;
        border: 1px solid #e89f18;
    }
    
    #legend span#targeted-multi-family-housing-legend {
        background: #657d9b;
        border: 1px solid #324965;
    }
    
    #legend span#planning-areas-legend {
        background: #b5e15c;
        border: 1px solid #48ae18;
    }
    
    #legend span#opportunity-zones-legend {
        background: #eb9e34;
        border: 1px solid #ba7311;
    }
    
    #legend span#completed-planning-projects-legend {
        background: #39b54a;
        border: 1px solid #2e9a3d;
    }
    
    #legend span#streetscape-improvements-legend {
        background: #333333;
    }
    
    #legend span#dlba-structures-legend {
        background: #53ade9;
    }
    
    #legend span#dlba-vacant-lots-legend {
        background: #8cc9f2;
    }
    
    #legend span#dlba-side-lots-legend {
        background: #81b2d3;
    }
    
    #legend span#dlba-auctions-legend {
        background: #515166;
    }
    
    #legend span#dlba-rehabbed-and-ready-legend {
        background: #ff6501;
    }
    
    #legend span#dlba-own-it-now-legend {
        background: #0000ff;
    }
</style>
<main class="red-portal">
    <br>
    <br>
    <div class="description container">
        <p>Navigate the map below to understand development opportunities across Detroit. Some key layers to explore are:
        </p>
        <ul>
            <li><strong>To purchase city owned property and /or buildings</strong> - select Detroit Land Bank Authority and/or City Owned properties</li>
            <li><strong>To understand development opportunities</strong>&nbsp;- select Request for Proposals</li>
            <li><strong>To understand planning areas in Detroit</strong> - Explore Planning and Housing Priority Areas</li>
            <li><strong>To understand the retail / commercial landscape in Detroit</strong> - Navigate options under Retail to see where Motor City Match and Motor City Restore award recipients are located</li>
        </ul>
        <br>
    </div>
    <div id="map-container" style="margin:0 auto">
        <div id="legend">
            <h3>MAP LEGEND</h3>
            <div>
                <h5 class="legend-category">PUBLIC ASSETS</h5>
                <ul id="public-assets-legend">
                    <!--li><span id="city-owned-for-sale-legend" class="circle"></span>City-Owned Properties for Sale</li-->
                    <!--li><span id="city-owned-legend" class="circle"></span>City-Owned Properties</li-->
                    <li><span id="parks-legend" class="square"></span>Parks</li>
                    <li><span id="dlba-structures-legend" class="circle"></span>DLBA Structures</li>
                    <li><span id="dlba-vacant-lots-legend" class="circle"></span>DLBA Vacant Lots</li>
                    <li><span id="dlba-side-lots-legend" class="circle"></span>DLBA Side Lots</li>
                    <li><span id="dlba-auctions-legend" class="circle"></span>DLBA Auctions</li>
                    <li><span id="dlba-rehabbed-and-ready-legend" class="circle"></span>DLBA Rehabbed & Ready</li>
                    <li><span id="dlba-own-it-now-legend" class="circle"></span>DLBA Own It Now</li>
                </ul>
                <h5 class="legend-category">RETAIL</h5>
                <ul id="retail-legend">
                    <li><span id="motor-city-match-businesses-legend" class="circle"></span>Motor City Match Awardees</li>
                    <li><span id="motor-city-restore-legend" class="circle"></span>Motor City Re-Store</li>
                </ul>
                <h5 class="legend-category">PLANNING AND HOUSING</h5>
                <ul id="planning-and-housing-legend">
                    <li><span id="opportunity-zones-legend" class="square"></span>Opportunity Zones</li>
                    <li><span id="targeted-multi-family-housing-legend" class="square"></span>Targeted Multifamily Housing Areas</li>
                    <li><span id="planning-areas-legend" class="square"></span>Planning Areas</li>
                    <li><span id="snf-areas-legend" class="square"></span>Strategic Neighborhood Fund Investment Areas</li>
                    <li><span id="streetscape-improvements-legend" class="line"></span>Streetscape Improvements</li>
                    <li><span id="completed-planning-projects-legend" class="square"></span>Completed Planning Studies</li>
                </ul>
                <h5 class="legend-category">DEVELOPMENT</h5>
                <ul id="development-legend">
                    <li><span id="open-rfp-legend" class="square"></span>Open RFPs</li>
                    <li><span id="predevelopment-rfp-legend" class="square"></span>Pre-Development RFP</li>
                    <li><span id="in-construction-rfp-legend" class="square"></span>In Construction RFP</li>
                    <li><span id="completed-rfp-legend" class="square"></span>Completed RFP</li>
                    <li><span id="vacant-multi-legend" class="square"></span>Vacant Multifamily (In-Progress)</li>
                    <!--li><span id="open-residential-permits-legend" class="circle"></span>Open Residential Permits</li>
        <li><span id="one-million-permits-legend" class="circle"></span>Open Commercial ($0-$1M)</li>
        <li><span id="over-one-million-permits-legend" class="circle"></span>Open Commercial ($1M+)</li-->
                    <!--li><span id="permits-legend" class="circle"></span>Building Permits ($500K-$1M)</li-->
                </ul>
                <h5 class="legend-category">PUBLIC TRANSPORTATION</h5>
                <ul id="public-transportation-legend">
                    <!--li><span id="ddot-bus-legend" class="line"></span>DDoT Buses</li-->
                    <li><span id="smart-bus-legend" class="line"></span>Smart Bus</li>
                    <li><span id="qline-route-legend"><span id="qline-circle-legend" class="circle"></span><span id="qline-line-legend" class="line"></span></span>Qline</li>
                    <li><span id="peoplemover-legend" class="line"></span>People Mover</li>
                    <li><span id="mogobikes-legend" class="circle"></span>MoGo Bike Sharing</li>
                </ul>
                <h5 class="legend-category">ZONING AREA</h5>
                <ul class="zoning-list-legend" id="residential-zoning-legend">
                    <li><span id="R1-legend" class="square"></span>R1</li>
                    <li><span id="R2-legend" class="square"></span>R2</li>
                    <li><span id="R3-legend" class="square"></span>R3</li>
                    <li><span id="R4-legend" class="square"></span>R4</li>
                    <li><span id="R5-legend" class="square"></span>R5</li>
                    <li><span id="R6-legend" class="square"></span>R6</li>
                </ul>
                <ul class="zoning-list-legend" id="business-zoning-legend">
                    <li><span id="B1-legend" class="square"></span>B1</li>
                    <li><span id="B2-legend" class="square"></span>B2</li>
                    <li><span id="B3-legend" class="square"></span>B3</li>
                    <li><span id="B4-legend" class="square"></span>B4</li>
                    <li><span id="B5-legend" class="square"></span>B5</li>
                    <li><span id="B6-legend" class="square"></span>B6</li>
                </ul>
                <ul class="zoning-list-legend" id="industrial-zoning-legend">
                    <li><span id="M1-legend" class="square"></span>M1</li>
                    <li><span id="M2-legend" class="square"></span>M2</li>
                    <li><span id="M3-legend" class="square"></span>M3</li>
                    <li><span id="M4-legend" class="square"></span>M4</li>
                    <li><span id="M5-legend" class="square"></span>M5</li>
                </ul>
                <ul class="zoning-list-legend" id="special-districts-zoning-legend">
                    <li><span id="SD1-legend" class="square"></span>SD1</li>
                    <li><span id="SD2-legend" class="square"></span>SD1</li>
                    <li><span id="SD3-legend" class="square"></span>SD3</li>
                    <li><span id="SD4-legend" class="square"></span>SD4</li>
                    <li><span id="SD5-legend" class="square"></span>SD5</li>
                    <li><span id="SD6-legend" class="square"></span>SD6</li>
                </ul>
                <ul class="zoning-list-legend" id="other-special-districts-zoning-legend">
                    <li><span id="PD-legend" class="square"></span>PD</li>
                    <li><span id="P1-legend" class="square"></span>P1</li>
                    <li><span id="PC-legend" class="square"></span>PC</li>
                    <li><span id="PCA-legend" class="square"></span>PCA</li>
                    <li><span id="TM-legend" class="square"></span>TM</li>
                    <li><span id="PR-legend" class="square"></span>PR</li>
                    <li><span id="W1-legend" class="square"></span>W1</li>
                </ul>
            </div>
        </div>
        <div id="map" class="mapboxgl-map">
            <a id="filters-toggle" href="#">Show/Hide Data Layers</a>
            <!-- Start Paste Here -->
            <div id="map-filters">
                <ul>
                    <li>
                        <input id="public-assets" name="public-assets" type="checkbox">
                        <label for="public-assets" class="category" id="public-assets-label">Public Assets</label>
                        <ul>
                            <li class="subcategory">
                                <input class="public-assets-checkbox public-assets-header" id="city-owned-properties" name="city-owned-properties" type="checkbox">
                                <label for="city-owned-properties">City-Owned Parcels</label>
                                <ul>
                                    <!--li>
            <input class="public-assets-checkbox" id="marketed-properties" name="marketed-properties" type="checkbox">
            <label for="marketed-properties">City-Owned Properties for Sale</label>
            </li>
            <li>
            <input class="public-assets-checkbox" id="tax-status-city-owned-properties" name="tax-status-city-owned-properties" type="checkbox">
            <label for="tax-status-city-owned-properties">City-Owned Properties</label>
            </li-->
                                    <li>
                                        <input class="public-assets-checkbox" id="parksgeojson" name="parksgeojson" type="checkbox">
                                        <label for="parksgeojson">Parks</label>
                                    </li>
                                </ul>
                            </li>
                            <li class="subcategory">
                                <input class="public-assets-checkbox dlba-inventory-checkbox public-assets-header" id="dlba-inventory" name="dlba-inventory" type="checkbox">
                                <label for="dlba-inventory">Detroit Land Bank Authority</label>
                                <ul>
                                    <li>
                                        <input class="dlba-inventory-checkbox" id="dlba-structures" name="dlba-structures" type="checkbox">
                                        <label for="dlba-structures">Structures</label>
                                    </li>
                                    <li>
                                        <input class="dlba-inventory-checkbox" id="dlba-vacant-lots" name="dlba-vacant-lots" type="checkbox">
                                        <label for="dlba-vacant-lots">Vacant Lots</label>
                                    </li>
                                    <li>
                                        <input class="dlba-inventory-checkbox" id="dlba-side-lots" name="dlba-side-lots" type="checkbox">
                                        <label for="dlba-side-lots">Side Lots</label>
                                    </li>
                                    <li>
                                        <input class="dlba-inventory-checkbox" id="dlba-auctions" name="dlba-auctions" type="checkbox">
                                        <label for="dlba-auctions">Auctions</label>
                                    </li>
                                    <li>
                                        <input class="dlba-inventory-checkbox" id="dlba-rehabbed-and-ready" name="dlba-rehabbed-and-ready" type="checkbox">
                                        <label for="dlba-rehabbed-and-ready">Rehabbed & Ready</label>
                                    </li>
                                    <li>
                                        <input class="dlba-inventory-checkbox" id="dlba-own-it-now" name="dlba-own-it-now" type="checkbox">
                                        <label for="dlba-own-it-now">Own It Now</label>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <input id="retail" name="retail" type="checkbox">
                        <label for="retail" class="category" id="retail-label">Retail</label>
                        <ul>
                            <li class="subcategory">
                                <input class="retail-checkbox retail-header" id="mcm-business" name="mcm-business" type="checkbox">
                                <label for="mcm-business">Motor City Match Awardees</label>
                            </li>
                            <li class="subcategory">
                                <input class="retail-header" id="mc-restore" name="mc-restore" type="checkbox">
                                <label for="mc-restore">Motor City Re-Store</label>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <input id="planning-and-housing-priority-areas" name="planning-and-housing-priority-areas" type="checkbox">
                        <label for="planning-and-housing-priority-areas" class="category" id="planning-label">Planning & Housing </label>
                        <ul id="planning-area-list">
                            <li>
                                <input class="planning-checkbox" id="opportunity-zones" name="opportunity-zones" type="checkbox">
                                <label for="opportunity-zones">Opportunity Zones</label>
                            </li>
                            <li>
                                <input class="planning-checkbox" id="targeted-multi-family-housing" name="targeted-multi-family-housing" type="checkbox">
                                <label for="targeted-multi-family-housing">Targeted Multifamily Housing Areas</label>
                            </li>
                            <li>
                                <input class="planning-checkbox" id="planning-areas" name="planning-areas" type="checkbox">
                                <label for="planning-areas">Planning Areas</label>
                            </li>
                            <!--li>
                                            <input class="planning-checkbox" id="snf-areas" name="snf-areas" type="checkbox">
                                            <label for="snf-areas">Strategic Neighborhood Fund Investment Areas</label>
                                        </li-->
                            <li>
                                <input class="planning-checkbox" id="streetscape-improvements" name="streetscape-improvements" type="checkbox">
                                <label for="streetscape-improvements">Streetscape Improvements</label>
                            </li>
                            <li>
                                <input class="planning-checkbox" id="completed-planning-projects" name="completed-planning-projects" type="checkbox">
                                <label for="completed-planning-projects">Completed Planning Studies</label>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <input id="development" name="development" type="checkbox">
                        <label for="development" class="category" id="development-label">Development</label>
                        <ul>
                            <li class="subcategory">
                                <input class="development-checkbox development-header" id="rfp" name="rfp" type="checkbox">
                                <label for="rfp">Request for Proposals</label>
                                <ul>
                                    <li>
                                        <input class="development-checkbox" id="open-rfp" name="open-rfp" type="checkbox">
                                        <label for="open-rfp">Open to Submissions</label>
                                    </li>
                                    <li>
                                        <input class="development-checkbox" id="predevelopment-rfp" name="predevelopment-rfp" type="checkbox">
                                        <label for="predevelopment-rfp">Pre-Development</label>
                                    </li>
                                    <li>
                                        <input class="development-checkbox" id="in-construction-rfp" name="in-construction-rfp" type="checkbox">
                                        <label for="in-construction-rfp">In Construction</label>
                                    </li>
                                    <li>
                                        <input class="development-checkbox" id="completed-rfp" name="completed-rfp" type="checkbox">
                                        <label for="completed-rfp">Completed</label>
                                    </li>
                                </ul>
                            </li>
                            <li class="subcategory">
                                <!--input class="vacant-checkbox vacant-header" id="vacant-structures" name="vacant-structures" type="checkbox">
                                            <label for="vacant-structures">Vacant Structures</label>
                                            <ul>
                                                <li>
                                                    <input class="development-checkbox" id="vacant-commercial" name="vacant-commercial" type="checkbox">
                                                    <label for="vacant-commercial">Vacant Commercial</label>
                                                </li>
                                                <li-->
                                <input class="development-checkbox" id="vacant-multi" name="vacant-multi" type="checkbox">
                                <label for="vacant-multi">Vacant Multifamily (In-Progress)</label>
                                <!--/li>
                                                <li>
                                                    <input class="development-checkbox" id="vacant-land" name="vacant-land" type="checkbox">
                                                    <label for="vacant-land">Vacant Land</label>
                                                </li>
                                            </ul-->
                            </li>
                            <!--li class="subcategory">
          <input class="permits-header" id="building-permits" name="building-permits" type="checkbox">
          <label for="building-permits">Building Permits ($500K - $1M)</label>
          <!--ul>
            <li>
            <input class="permits-checkbox" id="residential-permits" name="residential-permits" type="checkbox">
            <label for="residential-permits">Open Residential Permits</label>
            </li>
            <li>
            <input class="permits-checkbox permits-header" id="commercial-permits" name="commercial-permits" type="checkbox">
            <label for="commercial-permits">Open Commercial Permits</label>
            <ul>
              <li>
              <input class="permits-checkbox" id="one-million" name="one-million" type="checkbox">
              <label for="one-million">$0 - $1M</label>
              </li>
              <li>
              <input class="permits-checkbox" id="twenty-five-million" name="twenty-five-million" type="checkbox">
              <label for="twenty-five-million">$1M+</label>
              </li>
              <li>
                                                            <input class="permits-checkbox" id="over-twenty-five-million" name="over-twenty-five-million" type="checkbox">
                                                            <label for="over-twenty-five-million">&#36;25M+</label>
                                                        </li>
            </ul>
            </li>
          </ul>
          </li-->
                        </ul>
                    </li>
                    <li>
                        <input id="public-transportation" name="public-transportation" type="checkbox">
                        <label for="public-transportation" class="category" id="public-transportation-label">Public Transportation</label>
                        <ul id="public-transportation-list">
                            <!--li>
          <input class="public-transportation-checkbox public-transportation-header" id="bus" name="bus" type="checkbox">
          <label for="bus">Bus</label>
          <ul>
            <li>
            <input class="public-transportation-checkbox" id="ddotroutes" name="ddotroutes" type="checkbox">
            <label for="ddotroutes">DDoT Buses</label>
            </li>
          </ul>
          </li-->
                            <li>
                                <input class="public-transportation-checkbox" id="smartroutes" name="smartroutes" type="checkbox">
                                <label for="smartroutes">Smart Buses</label>
                            </li>
                            <li>
                                <input class="public-transportation-checkbox" id="qline" name="qline" type="checkbox">
                                <label for="qline">QLine</label>
                            </li>
                            <li>
                                <input class="public-transportation-checkbox" id="peoplemover" name="peoplemover" type="checkbox">
                                <label for="peoplemover">People Mover</label>
                            </li>
                            <li>
                                <input class="public-transportation-checkbox" id="mogobikes" name="mogobikes" type="checkbox">
                                <label for="mogobikes">MoGo Bike Sharing</label>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <input id="zoning" name="zoning" type="checkbox">
                        <label for="zoning" class="category" id="zoning-label">Zoning</label>
                        <ul class="zoning-subcategory">
                            <li>
                                <input class="zoning-checkbox zoning-header" id="residential" name="residential" type="checkbox">
                                <label for="residential">Residential</label>
                                <ul>
                                    <li>
                                        <input class="zoning-checkbox" id="R1" name="R1" type="checkbox">
                                        <label for="R1">R1</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="R2" name="R2" type="checkbox">
                                        <label for="R2">R2</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="R3" name="R3" type="checkbox">
                                        <label for="R3">R3</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="R4" name="R4" type="checkbox">
                                        <label for="R4">R4</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="R5" name="R5" type="checkbox">
                                        <label for="R5">R5</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="R6" name="R6" type="checkbox">
                                        <label for="R6">R6</label>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="zoning-subcategory">
                            <li>
                                <input class="zoning-checkbox zoning-header" id="business" name="business" type="checkbox">
                                <label for="business">Business</label>
                                <ul>
                                    <li>
                                        <input class="zoning-checkbox" id="B1" name="B1" type="checkbox">
                                        <label for="B1">B1</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="B2" name="B2" type="checkbox">
                                        <label for="B2">B2</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="B3" name="B3" type="checkbox">
                                        <label for="B3">B3</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="B4" name="B4" type="checkbox">
                                        <label for="B4">B4</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="B5" name="B5" type="checkbox">
                                        <label for="B5">B5</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="B6" name="B6" type="checkbox">
                                        <label for="B6">B6</label>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="zoning-subcategory">
                            <li>
                                <input class="zoning-checkbox zoning-header" id="industrial" name="industrial" type="checkbox">
                                <label for="industrial">Industrial</label>
                                <ul>
                                    <li>
                                        <input class="zoning-checkbox" id="M1" name="M1" type="checkbox">
                                        <label for="M1">M1</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="M2" name="M2" type="checkbox">
                                        <label for="M2">M2</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="M3" name="M3" type="checkbox">
                                        <label for="M3">M3</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="M4" name="M4" type="checkbox">
                                        <label for="M4">M4</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="M5" name="M5" type="checkbox">
                                        <label for="M5">M5</label>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="zoning-subcategory">
                            <li>
                                <input class="zoning-checkbox zoning-header" id="special-district" name="special-district" type="checkbox">
                                <label for="special-district">Special Districts</label>
                                <ul>
                                    <li>
                                        <input class="zoning-checkbox" id="PD" name="PD" type="checkbox">
                                        <label for="PD">PD</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="P1" name="P1" type="checkbox">
                                        <label for="P1">P1</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="PC" name="PC" type="checkbox">
                                        <label for="PC">PC</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="PCA" name="PCA" type="checkbox">
                                        <label for="PCA">PCA</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="TM" name="TM" type="checkbox">
                                        <label for="TM">TM</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="PR" name="PR" type="checkbox">
                                        <label for="PR">PR</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="W1" name="W1" type="checkbox">
                                        <label for="W1">W1</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="SD1" name="SD1" type="checkbox">
                                        <label for="SD1">SD1</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="SD2" name="SD2" type="checkbox">
                                        <label for="SD2">SD2</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="SD3" name="SD3" type="checkbox">
                                        <label for="SD3">SD3</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="SD4" name="SD4" type="checkbox">
                                        <label for="SD4">SD4</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="SD5" name="SD5" type="checkbox">
                                        <label for="SD5">SD5</label>
                                    </li>
                                    <li>
                                        <input class="zoning-checkbox" id="SD6" name="SD6" type="checkbox">
                                        <label for="SD6">SD6</label>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="mapboxgl-missing-css">Missing Mapbox GL JS CSS
            </div>
            <div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate">
                <canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" width="504" height="710" style="position: absolute; width: 504px; height: 710px;"></canvas>
            </div>
            <div class="mapboxgl-control-container">
                <div class="mapboxgl-ctrl-top-left">
                </div>
                <div class="mapboxgl-ctrl-top-right">
                    <div class="mapboxgl-ctrl-geocoder mapboxgl-ctrl"><span class="geocoder-icon geocoder-icon-search"></span>
                        <input type="text" placeholder="Search">
                        <ul class="suggestions" style="display: none;" rel="display: none;">
                        </ul>
                        <div class="geocoder-pin-right">
                            <button class="geocoder-icon geocoder-icon-close" aria-label="Clear"></button><span class="geocoder-icon geocoder-icon-loading"></span>
                        </div>
                    </div>
                    <div class="mapboxgl-ctrl mapboxgl-ctrl-group">
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in" type="button" aria-label="Zoom In"></button>
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out" type="button" aria-label="Zoom Out"></button>
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-compass" type="button" aria-label="Reset North"><span class="mapboxgl-ctrl-compass-arrow" style="transform: rotate(0deg);"></span></button>
                    </div>
                </div>
                <div class="mapboxgl-ctrl-bottom-left">
                    <div class="mapboxgl-ctrl" style="display: block;">
                        <a class="mapboxgl-ctrl-logo" target="_blank" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a>
                    </div>
                </div>
                <div class="mapboxgl-ctrl-bottom-right">
                    <div class="mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact"><a href="https://www.mapbox.com/about/maps/" target="_blank">© Mapbox</a> <a href="http://www.openstreetmap.org/about/" target="_blank">© OpenStreetMap</a> <a class="mapbox-improve-map" href="https://www.mapbox.com/feedback/?owner=cityofdetroit&id=cjdm1ljis17142snw099izj6u&access_token=pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjaXZvOWhnM3QwMTQzMnRtdWhyYnk5dTFyIn0.FZMFi0-hvA60KYnI-KivWg" target="_blank">Improve this map</a>
                    </div>
                </div>
            </div>
            <div class="mapboxgl-missing-css">Missing Mapbox GL JS CSS
            </div>
            <div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate">
                <canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" width="791" height="710" style="position: absolute; width: 791px; height: 710px;"></canvas>
            </div>
            <div class="mapboxgl-control-container">
                <div class="mapboxgl-ctrl-top-left">
                </div>
                <div class="mapboxgl-ctrl-top-right">
                    <div class="mapboxgl-ctrl-geocoder mapboxgl-ctrl"><span class="geocoder-icon geocoder-icon-search"></span>
                        <input type="text" placeholder="Search">
                        <ul class="suggestions" style="display: none;" rel="display: none;">
                        </ul>
                        <div class="geocoder-pin-right">
                            <button class="geocoder-icon geocoder-icon-close" aria-label="Clear"></button><span class="geocoder-icon geocoder-icon-loading"></span>
                        </div>
                    </div>
                    <div class="mapboxgl-ctrl mapboxgl-ctrl-group">
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in" type="button" aria-label="Zoom In"></button>
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out" type="button" aria-label="Zoom Out"></button>
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-compass" type="button" aria-label="Reset North"><span class="mapboxgl-ctrl-compass-arrow" style="transform: rotate(0deg);"></span></button>
                    </div>
                </div>
                <div class="mapboxgl-ctrl-bottom-left">
                    <div class="mapboxgl-ctrl" style="display: block;">
                        <a class="mapboxgl-ctrl-logo" target="_blank" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a>
                    </div>
                </div>
                <div class="mapboxgl-ctrl-bottom-right">
                    <div class="mapboxgl-ctrl mapboxgl-ctrl-attrib"><a href="https://www.mapbox.com/about/maps/" target="_blank">© Mapbox</a> <a href="http://www.openstreetmap.org/about/" target="_blank">© OpenStreetMap</a> <a class="mapbox-improve-map" href="https://www.mapbox.com/feedback/?owner=cityofdetroit&id=cjdm1ljis17142snw099izj6u&access_token=pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjaXZvOWhnM3QwMTQzMnRtdWhyYnk5dTFyIn0.FZMFi0-hvA60KYnI-KivWg" target="_blank">Improve this map</a>
                    </div>
                </div>
            </div>
            <div class="mapboxgl-missing-css">Missing Mapbox GL JS CSS</div>
            <div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate">
                <canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" width="791" height="731" style="position: absolute; width: 791px; height: 731px;"></canvas>
            </div>
            <div class="mapboxgl-control-container">
                <div class="mapboxgl-ctrl-top-left"></div>
                <div class="mapboxgl-ctrl-top-right">
                    <div class="mapboxgl-ctrl-geocoder mapboxgl-ctrl"><span class="geocoder-icon geocoder-icon-search"></span>
                        <input type="text" placeholder="Search">
                        <ul class="suggestions" style="display: none;" rel="display: none;"></ul>
                        <div class="geocoder-pin-right">
                            <button class="geocoder-icon geocoder-icon-close" aria-label="Clear"></button><span class="geocoder-icon geocoder-icon-loading"></span></div>
                    </div>
                    <div class="mapboxgl-ctrl mapboxgl-ctrl-group">
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in" type="button" aria-label="Zoom In"></button>
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out" type="button" aria-label="Zoom Out"></button>
                        <button class="mapboxgl-ctrl-icon mapboxgl-ctrl-compass" type="button" aria-label="Reset North"><span class="mapboxgl-ctrl-compass-arrow" style="transform: rotate(0deg);"></span></button>
                    </div>
                </div>
                <div class="mapboxgl-ctrl-bottom-left">
                    <div class="mapboxgl-ctrl" style="display: block;">
                        <a class="mapboxgl-ctrl-logo" target="_blank" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a>
                    </div>
                </div>
                <div class="mapboxgl-ctrl-bottom-right">
                    <div class="mapboxgl-ctrl mapboxgl-ctrl-attrib"><a href="https://www.mapbox.com/about/maps/" target="_blank">© Mapbox</a> <a href="http://www.openstreetmap.org/about/" target="_blank">© OpenStreetMap</a> <a class="mapbox-improve-map" href="https://www.mapbox.com/feedback/?owner=cityofdetroit&id=cjdm1ljis17142snw099izj6u&access_token=pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjaXZvOWhnM3QwMTQzMnRtdWhyYnk5dTFyIn0.FZMFi0-hvA60KYnI-KivWg" target="_blank">Improve this map</a></div>
                </div>
            </div>
        </div>
        <div id="map-sidebar">
            <div id="tab-buttons">
                <span id="info-tab" class="tab-button active">INFO</span>
                <span id="glossary-tab" class="tab-button">GLOSSARY</span>
            </div>
            <div id="loadscreen">
                <strong class="loading"></strong>
                <p>Loading...
                </p>
            </div>
            <div id="glossary">
                <div>
                    <p class="public-assets-header">PUBLIC ASSETS
                    </p>
                    <p><strong>Detroit Land Bank Authority</strong> (DLBA) and the <strong>City of Detroit marketed properties for sale</strong> – Verify with the Detroit Building Authority and/or the DLBA for the most accurate information.
                    </p>
                </div>
                <br>
                <div>
                    <p class="public-assets-header">RETAIL
                    </p>
                    <p><strong>Motor City Match</strong> and <strong>Motor City Restore</strong> are programs run by the Detroit Economic Growth Corporation that support entrepreneurs and existing small businesses.
                    </p>
                </div>
                <br>
                <div>
                    <p class="public-assets-header">PLANNING & HOUSING
                    </p>
                    <p class="public-assets-sub-header">There are several planning areas for different purposes city wide, explainations are below:
                    </p>
                    <ul>
                        <li><strong>Targeted Multifamily Housing Areas</strong> – identify areas of the city with stronger housing markets and active commercial corridors. Developers of both market-rate and affordable housing, are encouraged to focus in these areas. To understand more, please check out the Housing & Revitalization Department Developers Page. </li>
                        <li><strong>Planning Areas and Strategic Neighborhood Fund Investment Areas</strong> are areas are subject to City of Detroit led neighborhood planning studies that use community engagement to guide future public investment and development in neighborhoods.</li>
                        <li><strong>Streetscape Improvements</strong> – Publically funded streetscape improvements intended to promote walkability and small businesses. </li>
                    </ul>
                </div>
                <br>
                <div>
                    <p class="public-assets-header">DEVELOPMENT
                    </p>
                    <p><strong>Request for Proposals</strong> - Calls for development teams to develop publically owned parcels and/or structures
                    </p>
                    <br>
                    <p><strong>Zoning: </strong>
                    </p>
                    <br>
                    <p><u>Residential</u>
                    </p>
                    <p id="R1"><strong>R1</strong> Single-Family Residential District
                    </p>
                    <p id="R2"><strong>R2</strong> Two-Family Residential District
                    </p>
                    <p id="R3"><strong>R3</strong> Low Density Residential District
                    </p>
                    <p id="R4"><strong>R4</strong> Thoroughfare Residential District
                    </p>
                    <p id="R5"><strong>R5</strong> Medium Density Residential District
                    </p>
                    <p id="R6"><strong>R6</strong> High Density Residential District
                    </p>
                    <br>
                    <p><u>Business / Commercial</u>
                    </p>
                    <p id="B1"><strong>B1</strong> Restricted Business District
                    </p>
                    <p id="B2"><strong>B2</strong> Local Business and Residential District
                    </p>
                    <p id="B3"><strong>B3</strong> Shopping District
                    </p>
                    <p id="B4"><strong>B4</strong> General Business District
                    </p>
                    <p id="B5"><strong>B5</strong> Major Business District
                    </p>
                    <p id="B6"><strong>B6</strong> General Services District
                    </p>
                    <br>
                    <p><u>Industrial Districts</u>
                    </p>
                    <p id="M1"><strong>M1</strong> Limited Industrial District
                    </p>
                    <p id="M2"><strong>M2</strong> Restricted Industrial District
                    </p>
                    <p id="M3"><strong>M3</strong> General Industrial District
                    </p>
                    <p id="M4"><strong>M4</strong> Intensive Industrial District
                    </p>
                    <p id="M5"><strong>M5</strong> Special Industrial District
                    </p>
                    <br>
                    <p><u>Special Districts</u>
                    </p>
                    <p id="PD"><strong>PD</strong> Planned Development District
                    </p>
                    <p id="P1"><strong>P1</strong> Open Parking District
                    </p>
                    <p id="PC"><strong>PC</strong> Public Center District
                    </p>
                    <p id="PCA"><strong>PCA</strong> Public Center Adjacent District (Restricted Central business District
                    </p>)
                    <p id="TM"><strong>TM</strong> Transitional-Industrial District
                    </p>
                    <p id="PR"><strong>PR</strong> Parks and Recreation District
                    </p>
                    <p id="W1"><strong>W1</strong> Waterfront-Industrial District
                    </p>
                    <p id="SD1"><strong>SD1</strong> Special Development District, Small-Scale, Mixed-Use
                    </p>
                    <p id="SD2"><strong>SD2</strong> Special Development District, Mixed-Use
                    </p>
                    <p id="SD3"><strong>SD3</strong> Special Development District, Technology and Research
                    </p>
                    <p id="SD4"><strong>SD4</strong> Special Development District, Riverfront mixed use
                    </p>
                    <p id="SD5"><strong>SD5</strong> Special Development District, Casinos
                    </p>
                </div>
                <div>
                    <p class="public-assets-header">PUBLIC TRANSPORTATION
                    </p>
                    <p><strong>DDOT Buses</strong> - Detroit Department of Transportation Bus Routes
                    </p>
                    <p><strong>SMART Buses</strong> - Suburban Mobility Authority for Regional Transportation (SMART) is Southeast Michigan's only regional bus system
                    </p>
                    <p><strong>QLine</strong> - 3.3 mile streetcar that rides along the Woodward Corridor
                    </p>
                    <p><strong>People Mover</strong> - Elevated Train that routed throughout Downtown Detroit
                    </p>
                    <p><strong>MoGo Bike Sharing</strong> - Bike rentals across the greater downtown
                    </p>
                </div>
            </div>
            <div id="map-sidebar-info">
                <h4 class="map-sidebar-header">DETROIT</h4>
                <div class="occupancy-data">
                    <div data-field="Photo_URL" class="frame"><img alt="Photo of Detroit" src="https://detroitmi.gov/sites/detroitmi.localhost/files/styles/de2e/public/2018-11/detroit1.jpg"></div>
                </div>
                <div style="display:none" class="mcm-data"></div>
                <div style="display:none" class="mcr-data"></div>
                <div style="display:none" class="permit-data"></div>
                <div class="key-data">
                    <h5>DEMOGRAPHICS</h5>
                    <p><span class="field-label">POPULATION:</span> 672,795</p>
                    <h5>REAL ESTATE</h5>
                    <p><span class="field-label"># CITY-OWNED PARCELS:</span> <span id="city-owned-number">9,029</span></p>
                    <p><span class="field-label"># DLBA PARCELS:</span> <span id="dlba-number">95,209</span></p>
                    <p><span class="field-label"># TOTAL RFP DEVELOPMENTS:</span> <span id="total-rfp-number">27</span></p>
                    <p><span class="field-label"># OPEN BUILDING PERMITS ($500K - $1M):</span> <span id="permits-number">2</span></p>
                    <h5>INFRASTRUCTURE</h5>
                    <p><span class="field-label"># CITY-OWNED PARKS:</span> <span id="city-owned-parks-number">309</span></p>
                    <h5>RETAIL</h5>
                    <p><span class="field-label">MOTOR CITY MATCH OPEN BUSINESSES:</span> <span id="motor-city-match-businesses-number">36</span></p>
                    <p><span class="field-label">MOTOR CITY RESTORE RECIPIENTS:</span> <span id="motor-city-restore-number">68</span></p>
                </div>
                <div class="additional-data"></div>
            </div>
        </div>

    </div>
    <!-- End Paste Here -->
    <br>
    <div class="container">Opportunity Map data is sourced from the following: Detroit Open Data Portal, Detroit Land Bank Authority (DLBA), City of Detroit Assessors Office, Housing and Revitalization Department, Planning and Development Department, Detroit Economic Growth Corporation - Motor City Match and Motor City Restore, Data Driven Detroit, Buildings and Safety Engineering and Environment Department, Department of Transportation. In a few instances, DLBA data may be more up-to-date than the City of Detroit Assessors Office. For questions, please visit the City of Detroit Assessors Office and/or provide us direct feedback <a href="https://app.smartsheet.com/b/form/e2fe1e14bf2b49f4a7d146797fc26229">here</a>.</div>
    <br>
</main>
<script>
  //activate toggle on filters button
  $(document).ready(function() {
    $("#filters-toggle").click(function(e) {
      e.preventDefault();
      if ($("#map-filters").is(":visible")) {
        map.flyTo({
          center: [-83.1, 42.36],
          zoom: 10.5,
          bearing: 0,

          // These options control the flight curve, making it move
          // slowly and zoom out almost completely before starting
          // to pan.
          speed: 2, // make the flying slow
          curve: 1, // change the speed at which it zooms out

          // This can be any easing function: it takes a number between
          // 0 and 1 and returns another number between 0 and 1.
          easing: function(t) {
            return t;
          }
        });
      }
      $("#map-filters").slideToggle("slow", function() {});
    });
    $(".tab-button").click(function() {
      var newActiveTab = $(this).attr("id");
      if (newActiveTab === "glossary-tab") {
        $("#map-sidebar-info").hide();
        $("#info-tab").removeClass("active");
        $("#glossary").show();
        $(this).addClass("active");
      } else {
        $("#glossary").hide();
        $("#glossary-tab").removeClass("active");
        $("#map-sidebar-info").show();
        $(this).addClass("active");
      }
    });
  });

  //get Date a year ago today
  var today = new Date();
  var dd = today.getDate();
  var mm = today.getMonth() + 1;
  var yyyy = today.getFullYear() - 1;
  var permitDate = yyyy + "-" + mm + "-" + dd;

  function getCitywideStats() {
    $("#map-sidebar-info .map-sidebar-header").empty();
    $("#map-sidebar-info .permit-data").empty();
    $("#map-sidebar-info .key-data").empty();
    $("#map-sidebar-info .mcr-data").empty();
    $("#map-sidebar-info .mcm-data").empty();
    $("#map-sidebar-info .occupancy-data").empty();
    $("#map-sidebar-info .additional-data").empty();
    $.get(
      "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Requests_for_Proposal/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=",
      function(rfpCount) {
        $("#total-rfp-number").text(rfpCount.features.length.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,"));
      },
      "json"
    ),
      $.get(
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/assessor_parcels_opendata/FeatureServer/0/query?where=TAX_STATUS%20%3D%20%27CITY%20OWNED%27&outFields=*&returnCountOnly=true&outSR=4326&f=json",
        function(cityOwnedCount) {
          $("#city-owned-number").text(cityOwnedCount.count.toLocaleString());
        },
        "json"
      ),
      // $.get('https://data.detroitmi.gov/resource/but4-ky7y.geojson?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22RESIDENTIAL%22&$limit=50000', function(residentialPermitsCount) {$('#open-residential-permits-number').text(residentialPermitsCount.features.length.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,"))}, 'json');
      // $.get('https://data.detroitmi.gov/resource/but4-ky7y.geojson?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22NON-RESIDENTIAL%22&$limit=50000', function(commercialPermitsCount) { $('#open-commercial-permits-number').text(commercialPermitsCount.features.length.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,"))}, 'json');
      $.get(
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/ParksRec/FeatureServer/2/query?where=1%3D1&returnCountOnly=true&f=pjson",
        function(parksCount) {
          $("#city-owned-parks-number").text(parksCount.count.toLocaleString());
        },
        "json"
      );
    $.get(
      "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DLBA_Owned_Properties/FeatureServer/0/query?where=1%3D1&outFields=*&returnCountOnly=true&outSR=4326&f=json",
      function(dlbaCount) {
        $("#dlba-number").text(dlbaCount.count.toLocaleString());
      },
      "json"
    );
    $.get(
      "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/MCRS_Awardees/FeatureServer/0/query?where=1%3D1&outFields=*&returnCountOnly=true&outSR=4326&f=json",
      function(mcRestoreCount) {
        $("#motor-city-restore-number").text(mcRestoreCount.count.toLocaleString());
      },
      "json"
    );
    $.get(
      "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/MCM_Cash_Awardees/FeatureServer/0/query?where=1%3D1&outFields=*&returnCountOnly=true&outSR=4326&f=json",
      function(mcmBusinessCount) {
        $("#motor-city-match-businesses-number").text(mcmBusinessCount.count.toLocaleString());
      },
      "json"
    );
    $("#map-sidebar-info .map-sidebar-header").text("DETROIT");
    $("#map-sidebar-info .occupancy-data").append(
      '<div data-field="Photo_URL" class="frame"><img alt="Photo of Detroit" src="https://detroitmi.gov/sites/detroitmi.localhost/files/styles/de2e/public/2018-11/detroit1.jpg"></div>'
    );
    $("#map-sidebar-info .key-data").append('<h5><span>DEMOGRAPHICS</span></h5><p><span class="field-label">POPULATION:</span> 672,795</p>');
    $("#map-sidebar-info .key-data").append(
      '<h5><span>REAL ESTATE</span></h5><p><span class="field-label"># CITY-OWNED PARCELS:</span> <span id="city-owned-number">9,254</span></p><p><span class="field-label"># DLBA PARCELS:</span> <span id="dlba-number">95,762</span></p><p><span class="field-label"># TOTAL RFP DEVELOPMENTS:</span> <span id="total-rfp-number">21</span></p><p><span class="field-label"># OPEN BSEED COMMERCIAL PERMITS:</span> <span id="open-commercial-permits-number">667</span></p><p><span class="field-label"># OPEN BSEED RESIDENTIAL PERMITS:</span> <span id="open-residential-permits-number">2,526</span></p>'
    );
    $("#map-sidebar-info .key-data").append(
      '<h5><span>INFRASTRUCTURE</span></h5><p><span class="field-label"># CITY-OWNED PARKS:</span> <span id="city-owned-parks-number">309</span></p>'
    );
    $("#map-sidebar-info .key-data").append(
      '<h5><span>RETAIL</span></h5><p><span class="field-label">MOTOR CITY MATCH OPEN BUSINESSES:</span> <span id="motor-city-match-businesses-number">672,795</span></p><p><span class="field-label">MOTOR CITY RESTORE RECIPIENTS:</span> <span id="motor-city-restore-number">672,795</span></p>'
    );
  }
  getCitywideStats();

  //Nested Checkboxes
  $('input[type="checkbox"]').change(function(e) {
    var checked = $(this).prop("checked"),
      container = $(this).parent(),
      siblings = container.siblings();

    container.find('input[type="checkbox"]').prop({
      indeterminate: false,
      checked: checked
    });

    function checkSiblings(el) {
      var parent = el.parent().parent(),
        all = true;

      el.siblings().each(function() {
        return (all =
          $(this)
            .children('input[type="checkbox"]')
            .prop("checked") === checked);
      });

      if (all && checked) {
        parent.children('input[type="checkbox"]').prop({
          indeterminate: false,
          checked: checked
        });

        checkSiblings(parent);
      } else if (all && !checked) {
        parent.children('input[type="checkbox"]').prop("checked", checked);
        parent.children('input[type="checkbox"]').prop("indeterminate", parent.find('input[type="checkbox"]:checked').length > 0);
        checkSiblings(parent);
      } else {
        el.parents("li")
          .children('input[type="checkbox"]')
          .prop({
            indeterminate: true,
            checked: false
          });
      }
    }

    checkSiblings(container);
  });

  mapboxgl.accessToken = "pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjaXZvOWhnM3QwMTQzMnRtdWhyYnk5dTFyIn0.FZMFi0-hvA60KYnI-KivWg";
  var map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/cityofdetroit/cjdm1ljis17142snw099izj6u",
    center: [-83.1, 42.36],
    zoom: 10.5
  });
  var geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    bbox: [-83.3437, 42.2102, -82.8754, 42.5197]
  });
  map.addControl(geocoder);
  geocoder.on("result", function(ev) {
    //console.log(ev);
    map.flyTo({
      center: [ev.result.geometry.coordinates[0], ev.result.geometry.coordinates[1]],
      zoom: 16,
      bearing: 0,

      // These options control the flight curve, making it move
      // slowly and zoom out almost completely before starting
      // to pan.
      speed: 2, // make the flying slow
      curve: 1, // change the speed at which it zooms out

      // This can be any easing function: it takes a number between
      // 0 and 1 and returns another number between 0 and 1.
      easing: function(t) {
        return t;
      }
    });
    var tempInputList = document.querySelectorAll(".mapboxgl-ctrl-geocoder.mapboxgl-ctrl > input");
    var tempAddr = "";
    for (var i = 0; i < tempInputList.length; i++) {
      if (tempInputList[i].value.split(",")[0] !== "") {
        // console.log(tempInputList[i].value.split(',')[0]);
        tempAddr = tempInputList[i].value.split(",")[0];
        tempAddr = tempAddr.split(" ");
        break;
      } else {
        // console.log("Empty input");
      }
    }
    var newTempAddr = "";
    var size = tempAddr.length;
    tempAddr.forEach(function(item, index) {
      newTempAddr += item;
      index < size && index + 1 !== size ? (newTempAddr += "+") : 0;
    });
    //console.log(newTempAddr);
    //================ get parcel data ==========================
    $.getJSON(
      "https://gis.detroitmi.gov/arcgis/rest/services/DoIT/CompositeGeocoder/GeocodeServer/findAddressCandidates?Street=&City=&ZIP=&SingleLine=" +
        newTempAddr +
        "&category=&outFields=User_fld&maxLocations=&outSR=&searchExtent=&location=&distance=&magicKey=&f=pjson",
      function(data) {
        //console.log(data);
        //console.log(data.candidates[0].attributes.User_fld);
        map.setFilter("parcel-fill-hover", ["==", "parcelno", data.candidates[0].attributes.User_fld]);
        getParcelInfo(data.candidates[0].attributes.User_fld, ev.result.geometry.coordinates[0], ev.result.geometry.coordinates[1]);
      }
    );
  });

  map.addControl(new mapboxgl.NavigationControl());
  map.on("load", function() {
    map.addSource("parcels", {
      type: "vector",
      url: "mapbox://cityofdetroit.4pyiqqv4"
    });
    map.addSource("zoning", {
      type: "vector",
      url: "mapbox://cityofdetroit.5kwrqmxx"
    });
    map.addSource("completed-planning-projects", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/PlanningProjects/FeatureServer/0/query?where=SNF+%3D+%27%27+AND+Status+%3D+%27Completed%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnHiddenFields=false&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("planning-areas", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/PlanningProjects/FeatureServer/0/query?where=SNF+%3D+%27%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnHiddenFields=false&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("mcm-business", {
      type: "geojson",
      data: "https://opendata.arcgis.com/datasets/76e09cb0417a452aba99608ccf40f116_0.geojson"
    });
    map.addSource("mc-restore", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/MCRS_Awardees/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=geojson"
    });
    map.addSource("vacant-multi", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/rosaparks_clairmount_mf/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("snf-areas", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/PlanningProjects/FeatureServer/0/query?where=SNF+%3D+%27SNF%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnHiddenFields=false&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("open-rfp", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Requests_for_Proposal/FeatureServer/0/query?where=status_public+%3D+%27Open+to+Submissions%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("predevelopment-rfp", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Requests_for_Proposal/FeatureServer/0/query?where=status_public+%3D+%27Pre-Development%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("in-construction-rfp", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Requests_for_Proposal/FeatureServer/0/query?where=status_public+%3D+%27In+Construction%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("completed-rfp", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Requests_for_Proposal/FeatureServer/0/query?where=status_public+%3D+%27Completed%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    map.addSource("targeted-multi-family-housing", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Targeted_Multifamily_Affordable_Housing/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnHiddenFields=false&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="
    });
    // map.addSource('marketed-properties', {
    //     type: 'geojson',
    //     data: 'https://data.detroitmi.gov/resource/hww8-8shf.geojson?$where=property_type%20like%20%27MARKETED%20LAND%27%20OR%20property_type%20=%20%27MARKETED%20BUILDING%27&$limit=50000'
    // });
    // map.addSource('tax-status-city-owned-properties', {
    //     type: 'geojson',
    //     data: 'https://data.detroitmi.gov/resource/snut-x2sy.geojson?taxable_status=%27CITY%20OWNED%27&$limit=500000'
    // });
    // map.addSource('residential-permits', {
    //     type: 'geojson',
    //     data: 'https://data.detroitmi.gov/resource/but4-ky7y.geojson?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22RESIDENTIAL%22&$limit=50000'
    // });
    // map.addSource('one-million', {
    //     type: 'geojson',
    //     data: 'https://data.detroitmi.gov/resource/but4-ky7y.geojson?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22NON-RESIDENTIAL%22AND%20estimated_cost%3C1000000AND%20parcel_no!="08003608."&$limit=50000'
    // });
    // map.addSource('twenty-five-million', {
    //     type: 'geojson',
    //     data: 'https://data.detroitmi.gov/resource/but4-ky7y.geojson?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22NON-RESIDENTIAL%22AND%20estimated_cost%3E%221000000%22&$limit=50000'
    // });
    // /*map.addSource('over-twenty-five-million', {
    //     type: 'geojson',
    //     data: 'https://data.detroitmi.gov/resource/but4-ky7y.geojson?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22NON-RESIDENTIAL%22AND%20estimated_cost%3E25000000&$limit=50000'
    // });*/
    map.addSource("dlba-structures", {
      type: "vector",
      url: "mapbox://cityofdetroit.dlba_parcels"
    });
    map.addSource("dlba-vacant-lots", {
      type: "vector",
      url: "mapbox://cityofdetroit.dlba_parcels"
    });
    map.addSource("dlba-side-lots", {
      type: "vector",
      url: "mapbox://cityofdetroit.dlba_parcels"
    });
    map.addSource("dlba-auctions", {
      type: "vector",
      url: "mapbox://cityofdetroit.for_sale"
    });
    map.addSource("dlba-rehabbed-and-ready", {
      type: "vector",
      url: "mapbox://cityofdetroit.for_sale"
    });
    map.addSource("dlba-own-it-now", {
      type: "vector",
      url: "mapbox://cityofdetroit.for_sale"
    });
    map.addSource("peoplemover", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Detroit_People_Mover_Route/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"
    });
    map.addSource("mogobikes", {
      type: "geojson",
      data:
        "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/MoGo_Bike_Share_Locations/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"
    });
    map.addSource("ddotroutes", {
      type: "geojson",
      data: "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DDOT_Bus_Routes/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"
    });
    map.addSource("smartroutes", {
      type: "geojson",
      data: "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/SMART_Bus_Routes/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"
    });
    map.addSource("qlineroute", {
      type: "geojson",
      data: "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/QLine_Route/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"
    });
    map.addSource("qlinestops", {
      type: "geojson",
      data: "https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/QLine_Stops/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"
    });
    map.addLayer({
      id: "zoning",
      type: "line",
      source: "zoning",
      "source-layer": "zoninggeojson",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": {
          property: "zoning_rev",
          type: "categorical",
          stops: [
            ["B1", "#b16776"],
            ["B2", "#ca5572"],
            ["B3", "#e2396f"],
            ["B4", "#aa0044"],
            ["B5", "#952347"],
            ["B6", "#74001e"],
            ["M1", "#986eac"],
            ["M2", "#a265c2"],
            ["M3", "#ab5ad8"],
            ["M4", "#713891"],
            ["M5", "#792aa6"],
            ["P1", "#72a553"],
            ["PC", "#72a553"],
            ["PCA", "#72a553"],
            ["PD", "#72a553"],
            ["PR", "#72a553"],
            ["R1", "#8195ae"],
            ["R2", "#6097ce"],
            ["R3", "#009aee"],
            ["R4", "#006cbb"],
            ["R5", "#29699d"],
            ["R6", "#00428a"],
            ["SD1", "#c57c3d"],
            ["SD2", "#c57c3d"],
            ["SD4", "#c57c3d"],
            ["SD5", "#c57c3d"],
            ["TM", "#c57c3d"],
            ["W1", "#c57c3d"]
          ]
        },
        "line-width": {
          stops: [[14, 1], [19, 15]]
        },
        "line-offset": {
          stops: [[14, 0], [17, -1], [19, -6]]
        }
      }
    });
    map.addLayer({
      id: "targeted-multi-family-fill",
      type: "fill",
      source: "targeted-multi-family-housing",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#657d9b",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "targeted-multi-family-line",
      type: "line",
      source: "targeted-multi-family-housing",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#324965"
      }
    });/*
    map.addLayer({
      id: "residential-permits",
      type: "circle",
      source: "residential-permits",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 4,
          stops: [[12, 4], [22, 120]]
        },
        "circle-color": "#8195ae"
      }
    });
    map.addLayer({
      id: "one-million",
      type: "circle",
      source: "one-million",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 4,
          stops: [[12, 4], [22, 120]]
        },
        "circle-color": "#b16776"
      }
    });
    map.addLayer({
      id: "twenty-five-million",
      type: "circle",
      source: "twenty-five-million",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 4,
          stops: [[12, 4], [22, 120]]
        },
        "circle-color": "#ca5572"
      }
    });*/
    map.addLayer({
      id: "peoplemover",
      type: "line",
      source: "peoplemover",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#2c5490",
        "line-width": 2
      }
    });
    map.addLayer({
      id: "ddotroutes",
      type: "line",
      source: "ddotroutes",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#004736",
        "line-width": 2
      }
    });
    map.addLayer({
      id: "smartroutes",
      type: "line",
      source: "smartroutes",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#d70000",
        "line-width": 2
      }
    });
    map.addLayer({
      id: "qlineroute",
      type: "line",
      source: "qlineroute",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#7fb6ab",
        "line-width": 2
      }
    });
    map.addLayer({
      id: "mcm-business",
      type: "circle",
      source: "mcm-business",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 4,
          stops: [[12, 4], [22, 120]]
        },
        "circle-color": "#d26e03"
      }
    });
    map.addLayer({
      id: "mc-restore",
      type: "circle",
      source: "mc-restore",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 4,
          stops: [[12, 4], [22, 120]]
        },
        "circle-color": "#004445"
      }
    });
    map.addLayer({
      id: "mogobikes",
      type: "circle",
      source: "mogobikes",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 5,
          stops: [[12, 5], [22, 120]]
        },
        "circle-color": "#ee382a"
      }
    });
    map.addLayer({
      id: "qlinestops",
      type: "circle",
      source: "qlinestops",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 5,
          stops: [[12, 5], [22, 120]]
        },
        "circle-color": "#d64e34"
      }
    });
    /*map.addLayer({
                            "id": "over-twenty-five-million",
                            "type": "circle",
                            "source": "over-twenty-five-million",
                            "layout": {
                                'visibility': 'none'
                            },
                            "paint": {
                                'circle-radius': 5,
                                'circle-color': '#aa0044'
                            }
                        });*/
    /*map.addLayer({
      id: "marketed-properties",
      type: "circle",
      source: "marketed-properties",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 4,
          stops: [[12, 4], [22, 120]]
        },
        "circle-color": "#55d5c5"
      }
    });
    map.addLayer({
      id: "tax-status-city-owned-properties",
      type: "circle",
      source: "tax-status-city-owned-properties",
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 3,
          stops: [[12, 3], [22, 120]]
        },
        "circle-color": "#279989"
      }
    });*/
    map.addLayer({
      id: "vacant-multi-fill",
      type: "fill",
      source: "vacant-multi",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#f44289",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "vacant-multi-line",
      type: "line",
      source: "vacant-multi",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#a5295b"
      }
    });
    map.addLayer({
      id: "in-construction-rfp-fill",
      type: "fill",
      source: "in-construction-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#b94dba",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "in-construction-rfp-line",
      type: "line",
      source: "in-construction-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#b81aba"
      }
    });
    map.addLayer({
      id: "open-rfp-fill",
      type: "fill",
      source: "open-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#ff68ff",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "open-rfp-line",
      type: "line",
      source: "open-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#c56bc5"
      }
    });
    map.addLayer({
      id: "predevelopment-rfp-fill",
      type: "fill",
      source: "predevelopment-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#933c94",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "predevelopment-rfp-line",
      type: "line",
      source: "predevelopment-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#5f0b60"
      }
    });
    map.addLayer({
      id: "completed-rfp-fill",
      type: "fill",
      source: "completed-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#643265",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "completed-rfp-line",
      type: "line",
      source: "completed-rfp",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#5f0b60"
      }
    });
    map.addLayer({
      id: "snf-fill",
      type: "fill",
      source: "snf-areas",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#ffff73",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "snf-line",
      type: "line",
      source: "snf-areas",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#e89f18"
      }
    });
    map.addLayer({
      id: "dlba-structures",
      type: "fill",
      source: "dlba-structures",
      "source-layer": "dlba_parcels",
      filter: ["==", "status", "DLBA Owned Structure"],
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#53ade9"
      }
    });
    map.addLayer({
      id: "dlba-vacant-lots",
      type: "fill",
      source: "dlba-vacant-lots",
      "source-layer": "dlba_parcels",
      filter: ["==", "status", "DLBA Owned Vacant Land"],
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#8cc9f2"
      }
    });
    map.addLayer({
      id: "dlba-side-lots",
      type: "fill",
      source: "dlba-side-lots",
      "source-layer": "dlba_parcels",
      filter: ["==", "status", "DLBA Owned Sidelot For Sale"],
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#81b2d3"
      }
    });
    map.addLayer({
      id: "dlba-auctions",
      type: "circle",
      source: "dlba-auctions",
      "source-layer": "for_sale_mapbox",
      filter: ["==", "program", "Auction"],
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 3,
          stops: [[12, 3], [22, 120]]
        },
        "circle-color": "#515166"
      }
    });
    map.addLayer({
      id: "dlba-rehabbed-and-ready",
      type: "circle",
      source: "dlba-rehabbed-and-ready",
      "source-layer": "for_sale_mapbox",
      filter: ["==", "program", "Rehabbed & Ready"],
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 3,
          stops: [[12, 3], [22, 120]]
        },
        "circle-color": "#ff6501"
      }
    });
    map.addLayer({
      id: "dlba-own-it-now",
      type: "circle",
      source: "dlba-own-it-now",
      "source-layer": "for_sale_mapbox",
      filter: ["==", "program", "Own It Now"],
      layout: {
        visibility: "none"
      },
      paint: {
        "circle-radius": {
          base: 3,
          stops: [[12, 3], [22, 120]]
        },
        "circle-color": "#0000ff"
      }
    });
    map.addLayer({
      id: "completed-planning-projects-fill",
      type: "fill",
      source: "completed-planning-projects",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#39b54a",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "completed-planning-projects-line",
      type: "line",
      source: "completed-planning-projects",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#2e9a3d"
      }
    });
    map.addLayer({
      id: "planning-areas-fill",
      type: "fill",
      source: "planning-areas",
      layout: {
        visibility: "none"
      },
      paint: {
        "fill-color": "#b5e15c",
        "fill-opacity": 0.75
      }
    });
    map.addLayer({
      id: "planning-areas-line",
      type: "line",
      source: "planning-areas",
      layout: {
        visibility: "none"
      },
      paint: {
        "line-color": "#48ae18"
      }
    });
    map.addLayer({
      id: "parcel-fill",
      type: "fill",
      source: "parcels",
      minzoom: 13,
      layout: {},
      paint: {
        "fill-color": "#fff",
        "fill-opacity": 0
      },
      "source-layer": "assessor_parcels-50m4yu"
    });
    map.addLayer({
      id: "parcel-line",
      type: "line",
      source: "parcels",
      minzoom: 13,
      layout: {},
      paint: {
        "line-color": "#cbcbcb"
      },
      "source-layer": "assessor_parcels-50m4yu"
    });
    map.addLayer({
      id: "parcel-fill-hover",
      type: "line",
      source: "parcels",
      minzoom: 13,
      layout: {},
      paint: {
        "line-color": "#a40040"
      },
      "source-layer": "assessor_parcels-50m4yu",
      filter: ["==", "parcelno", ""]
    });
  });
  Number.prototype.formatMoney = function(c, d, t) {
    var n = this,
      c = isNaN((c = Math.abs(c))) ? 2 : c,
      d = d == undefined ? "." : d,
      t = t == undefined ? "," : t,
      s = n < 0 ? "-" : "",
      i = String(parseInt((n = Math.abs(Number(n) || 0).toFixed(c)))),
      j = (j = i.length) > 3 ? j % 3 : 0;
    return (
      s +
      (j ? i.substr(0, j) + t : "") +
      i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) +
      (c
        ? d +
          Math.abs(n - i)
            .toFixed(c)
            .slice(2)
        : "")
    );
  };

  function buildFilter(condition, dataColumn, filter_arr) {
    var filter = [condition, dataColumn];

    if (filter_arr.length === 0) {
      return filter;
    }

    for (var i = 0; i < filter_arr.length; i += 1) {
      filter.push(filter_arr[i]);
    }
    //console.log(filter)
    return filter;
  }

  function filterDataset(dataset, condition, dataColumn, filter_arr) {
    //console.log(dataset);
    //console.log(condition);
    //console.log(dataColumn);
    //console.log(filter_arr);
    map.setFilter(dataset, buildFilter(condition, dataColumn, filter_arr));
    map.setLayoutProperty(dataset, "visibility", "visible");
  }

  var zoning_filter = [];
  $("#map-filters input").click(function() {
    var this_source = this.id;
    if (this.checked) {
      /*//SNF Areas - on
                            if (this_source === "snf-areas") {
                                map.setLayoutProperty("snf-fill", "visibility", "visible");
                                map.setLayoutProperty("snf-line", "visibility", "visible");
                            } */
      //City-owned Properties - on
      if (this_source === "city-owned-properties") {
        /*map.setLayoutProperty("marketed-properties", "visibility", "visible");
        map.setLayoutProperty("tax-status-city-owned-properties", "visibility", "visible");*/
        map.setLayoutProperty("parksgeojson", "visibility", "visible");
      }
      //Retail - on
      else if (this_source === "retail") {
        map.setLayoutProperty("mcm-business", "visibility", "visible");
        map.setLayoutProperty("mc-restore", "visibility", "visible");
      }
      //Vacant Multifamily - on
      else if (this_source === "vacant-multi") {
        map.setLayoutProperty("vacant-multi-fill", "visibility", "visible");
        map.setLayoutProperty("vacant-multi-line", "visibility", "visible");
      }
      //Vacant Lots - off
      else if (this_source === "dlba-vacant-lots") {
        $("#dlba-side-lots").prop("checked", true);
        map.setLayoutProperty("dlba-vacant-lots", "visibility", "visible");
        map.setLayoutProperty("dlba-side-lots", "visibility", "visible");
      }
      //Public Assets - on
      else if (this_source === "public-assets") {
        map.setLayoutProperty("dlba-structures", "visibility", "visible");
        map.setLayoutProperty("dlba-vacant-lots", "visibility", "visible");
        map.setLayoutProperty("dlba-auctions", "visibility", "visible");
        map.setLayoutProperty("dlba-side-lots", "visibility", "visible");
        map.setLayoutProperty("dlba-rehabbed-and-ready", "visibility", "visible");
        map.setLayoutProperty("dlba-own-it-now", "visibility", "visible");
        /*map.setLayoutProperty("marketed-properties", "visibility", "visible");
        map.setLayoutProperty("tax-status-city-owned-properties", "visibility", "visible");*/
        map.setLayoutProperty("parksgeojson", "visibility", "visible");
      }
      //Development - on
      else if (this_source === "development") {
        map.setLayoutProperty("open-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("predevelopment-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("in-construction-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("completed-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("open-rfp-line", "visibility", "visible");
        map.setLayoutProperty("predevelopment-rfp-line", "visibility", "visible");
        map.setLayoutProperty("in-construction-rfp-line", "visibility", "visible");
        map.setLayoutProperty("completed-rfp-line", "visibility", "visible");
        /*map.setLayoutProperty("vacant-commercial", "visibility", "visible");
                                map.setLayoutProperty("vacant-multi", "visibility", "visible");
                                map.setLayoutProperty("vacant-land", "visibility", "visible");*/
        /*map.setLayoutProperty("residential-permits", "visibility", "visible");
        map.setLayoutProperty("one-million", "visibility", "visible");
        map.setLayoutProperty("twenty-five-million", "visibility", "visible");*/
        //map.setLayoutProperty("over-twenty-five-million", "visible", "visible");
      }
      //Planning and Housing Areas - on
      else if (this_source === "planning-and-housing-priority-areas") {
        map.setLayoutProperty("streetscape-improvements", "visibility", "visible");
        map.setLayoutProperty("targeted-multi-family-line", "visibility", "visible");
        map.setLayoutProperty("targeted-multi-family-fill", "visibility", "visible");
        map.setLayoutProperty("completed-planning-projects-fill", "visibility", "visible");
        map.setLayoutProperty("completed-planning-projects-line", "visibility", "visible");
        map.setLayoutProperty("planning-areas-fill", "visibility", "visible");
        map.setLayoutProperty("planning-areas-line", "visibility", "visible");
        map.setLayoutProperty("snf-fill", "visibility", "visible");
        map.setLayoutProperty("snf-line", "visibility", "visible");
      }
      //DLBA Inventory - on
      else if (this_source === "dlba-inventory") {
        map.setLayoutProperty("dlba-structures", "visibility", "visible");
        map.setLayoutProperty("dlba-vacant-lots", "visibility", "visible");
        map.setLayoutProperty("dlba-auctions", "visibility", "visible");
        map.setLayoutProperty("dlba-side-lots", "visibility", "visible");
        map.setLayoutProperty("dlba-rehabbed-and-ready", "visibility", "visible");
        map.setLayoutProperty("dlba-own-it-now", "visibility", "visible");
      }
      //Planning Areas - on
      else if (this_source === "planning-areas") {
        map.setLayoutProperty("snf-fill", "visibility", "visible");
        map.setLayoutProperty("snf-line", "visibility", "visible");
        map.setLayoutProperty("planning-areas-fill", "visibility", "visible");
        map.setLayoutProperty("planning-areas-line", "visibility", "visible");
      }
      //Completed Planning Projects - on
      else if (this_source === "completed-planning-projects") {
        map.setLayoutProperty("completed-planning-projects-fill", "visibility", "visible");
        map.setLayoutProperty("completed-planning-projects-line", "visibility", "visible");
      }
      //Targeted Multi-Family - on
      else if (this_source === "targeted-multi-family-housing") {
        map.setLayoutProperty("targeted-multi-family-fill", "visibility", "visible");
        map.setLayoutProperty("targeted-multi-family-line", "visibility", "visible");
      }
      //QLine - on
      else if (this_source === "qline") {
        map.setLayoutProperty("qlinestops", "visibility", "visible");
        map.setLayoutProperty("qlineroute", "visibility", "visible");
      }
      //Building Permits - on
      else if (this_source === "building-permits") {
        /*map.setLayoutProperty("residential-permits", "visibility", "visible");
        map.setLayoutProperty("one-million", "visibility", "visible");
        map.setLayoutProperty("twenty-five-million", "visibility", "visible");*/
        //map.setLayoutProperty("over-twenty-five-million", "visibility", "visible");
      }
      //RFPs - on
      else if (this_source === "rfp") {
        map.setLayoutProperty("open-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("open-rfp-line", "visibility", "visible");
        map.setLayoutProperty("predevelopment-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("predevelopment-rfp-line", "visibility", "visible");
        map.setLayoutProperty("completed-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("completed-rfp-line", "visibility", "visible");
        map.setLayoutProperty("in-construction-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("in-construction-rfp-line", "visibility", "visible");
      }
      //Open RFPs - on
      else if (this_source === "open-rfp") {
        map.setLayoutProperty("open-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("open-rfp-line", "visibility", "visible");
      }
      //Predevelopment RFPs - on
      else if (this_source === "predevelopment-rfp") {
        map.setLayoutProperty("predevelopment-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("predevelopment-rfp-line", "visibility", "visible");
      }
      //Completed RFPs - on
      else if (this_source === "completed-rfp") {
        map.setLayoutProperty("completed-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("completed-rfp-line", "visibility", "visible");
      }
      //In Construction RFPs - on
      else if (this_source === "in-construction-rfp") {
        map.setLayoutProperty("in-construction-rfp-fill", "visibility", "visible");
        map.setLayoutProperty("in-construction-rfp-line", "visibility", "visible");
      }
      //Commercial Permits - on
      else if (this_source === "commercial-permits") {
        /*map.setLayoutProperty("one-million", "visibility", "visible");
        map.setLayoutProperty("twenty-five-million", "visibility", "visible");*/
        //map.setLayoutProperty("over-twenty-five-million", "visibility", "visible");
      }
      //Bus routes - on
      else if (this_source === "bus") {
        map.setLayoutProperty("ddotroutes", "visibility", "visible");
        map.setLayoutProperty("smartroutes", "visibility", "visible");
      }
      //Public Transportation - on
      else if (this_source === "public-transportation") {
        map.setLayoutProperty("ddotroutes", "visibility", "visible");
        map.setLayoutProperty("smartroutes", "visibility", "visible");
        map.setLayoutProperty("qlinestops", "visibility", "visible");
        map.setLayoutProperty("qlineroute", "visibility", "visible");
        map.setLayoutProperty("mogobikes", "visibility", "visible");
        map.setLayoutProperty("peoplemover", "visibility", "visible");
      }
      //Zoning - on
      else if (this_source === "zoning") {
        zoning_filter = [];
        $(this)
          .parent("li")
          .find(".zoning-checkbox")
          .each(function(index, element) {
            if (!$(this).hasClass("zoning-header")) {
              zoning_filter.push($(this).attr("id"));
            }
          });
        filterDataset("zoning", "in", "zoning_rev", zoning_filter);
      } else if ($(this).hasClass("zoning-checkbox")) {
        $(".zoning-checkbox").each(function(index, element) {
          if ($(this).is(":checked")) {
            //console.log($(this).attr('id') + " is checked");
            if ($(this).hasClass("zoning-header")) {
              $(this)
                .siblings("ul")
                .children("li")
                .children("input")
                .each(function() {
                  if (zoning_filter.indexOf($(this).attr("id")) === -1) {
                    zoning_filter.push($(this).attr("id"));
                  }
                });
            } else {
              if (zoning_filter.indexOf($(this).attr("id")) === -1) {
                zoning_filter.push($(this).attr("id"));
              }
            }
          }
        });
        filterDataset("zoning", "in", "zoning_rev", zoning_filter);
      }
      //All other layers - on
      else {
        map.setLayoutProperty(this_source, "visibility", "visible");
      }
    }

    //If unchecking filter
    else {
      //DLBA Inventory - off
      if (this_source === "dlba-inventory") {
        map.setLayoutProperty("dlba-structures", "visibility", "none");
        map.setLayoutProperty("dlba-vacant-lots", "visibility", "none");
        map.setLayoutProperty("dlba-auctions", "visibility", "none");
        map.setLayoutProperty("dlba-side-lots", "visibility", "none");
        map.setLayoutProperty("dlba-rehabbed-and-ready", "visibility", "none");
        map.setLayoutProperty("dlba-own-it-now", "visibility", "none");
      }
      //City-Owned Properties - off
      else if (this_source === "city-owned-properties") {
        map.setLayoutProperty("marketed-properties", "visibility", "none");
        map.setLayoutProperty("tax-status-city-owned-properties", "visibility", "none");
        map.setLayoutProperty("parksgeojson", "visibility", "none");
      }
      //Vacant Multifamily - off
      else if (this_source === "vacant-multi") {
        map.setLayoutProperty("vacant-multi-fill", "visibility", "none");
        map.setLayoutProperty("vacant-multi-line", "visibility", "none");
      }
      //Vacant Lots - off
      else if (this_source === "dlba-vacant-lots") {
        $("#dlba-side-lots").prop("checked", false);
        map.setLayoutProperty("dlba-vacant-lots", "visibility", "none");
        map.setLayoutProperty("dlba-side-lots", "visibility", "none");
      }
      //Retail - off
      else if (this_source === "retail") {
        map.setLayoutProperty("mcm-business", "visibility", "none");
        map.setLayoutProperty("mc-restore", "visibility", "none");
      }
      //Planning and Housing Areas - off
      else if (this_source === "planning-and-housing-priority-areas") {
        map.setLayoutProperty("streetscape-improvements", "visibility", "none");
        map.setLayoutProperty("targeted-multi-family-fill", "visibility", "none");
        map.setLayoutProperty("targeted-multi-family-line", "visibility", "none");
        map.setLayoutProperty("completed-planning-projects-fill", "visibility", "none");
        map.setLayoutProperty("completed-planning-projects-line", "visibility", "none");
        map.setLayoutProperty("planning-areas-fill", "visibility", "none");
        map.setLayoutProperty("planning-areas-line", "visibility", "none");
        map.setLayoutProperty("snf-fill", "visibility", "none");
        map.setLayoutProperty("snf-line", "visibility", "none");
      }
      /*//SNF Areas - off
                            else if (this_source === "snf-areas") {
                                map.setLayoutProperty("snf-fill", "visibility", "none");
                                map.setLayoutProperty("snf-line", "visibility", "none");
                            } */
      //Planning Areas - off
      else if (this_source === "planning-areas") {
        map.setLayoutProperty("snf-fill", "visibility", "none");
        map.setLayoutProperty("snf-line", "visibility", "none");
        map.setLayoutProperty("planning-areas-fill", "visibility", "none");
        map.setLayoutProperty("planning-areas-line", "visibility", "none");
      }
      //Targeted Multi-Family - off
      else if (this_source === "targeted-multi-family-housing") {
        map.setLayoutProperty("targeted-multi-family-fill", "visibility", "none");
        map.setLayoutProperty("targeted-multi-family-line", "visibility", "none");
      }
      //RFPs - off
      else if (this_source === "rfp") {
        map.setLayoutProperty("open-rfp-fill", "visibility", "none");
        map.setLayoutProperty("open-rfp-line", "visibility", "none");
        map.setLayoutProperty("predevelopment-rfp-fill", "visibility", "none");
        map.setLayoutProperty("predevelopment-rfp-line", "visibility", "none");
        map.setLayoutProperty("completed-rfp-fill", "visibility", "none");
        map.setLayoutProperty("completed-rfp-line", "visibility", "none");
        map.setLayoutProperty("in-construction-rfp-fill", "visibility", "none");
        map.setLayoutProperty("in-construction-rfp-line", "visibility", "none");
      }
      //Open RFPs - off
      else if (this_source === "open-rfp") {
        map.setLayoutProperty("open-rfp-fill", "visibility", "none");
        map.setLayoutProperty("open-rfp-line", "visibility", "none");
      }
      //Predevelopment RFPs - off
      else if (this_source === "predevelopment-rfp") {
        map.setLayoutProperty("predevelopment-rfp-fill", "visibility", "none");
        map.setLayoutProperty("predevelopment-rfp-line", "visibility", "none");
      }
      //Completed RFPs - off
      else if (this_source === "completed-rfp") {
        map.setLayoutProperty("completed-rfp-fill", "visibility", "none");
        map.setLayoutProperty("completed-rfp-line", "visibility", "none");
      }
      //In Construction RFPs - off
      else if (this_source === "in-construction-rfp") {
        map.setLayoutProperty("in-construction-rfp-fill", "visibility", "none");
        map.setLayoutProperty("in-construction-rfp-line", "visibility", "none");
      }
      //Completed Planning Areas - off
      else if (this_source === "completed-planning-projects") {
        map.setLayoutProperty("completed-planning-projects-fill", "visibility", "none");
        map.setLayoutProperty("completed-planning-projects-line", "visibility", "none");
      }
      //Development - off
      else if (this_source === "development") {
        map.setLayoutProperty("open-rfp-fill", "visibility", "none");
        map.setLayoutProperty("predevelopment-rfp-fill", "visibility", "none");
        map.setLayoutProperty("in-construction-rfp-fill", "visibility", "none");
        map.setLayoutProperty("completed-rfp-fill", "visibility", "none");
        map.setLayoutProperty("open-rfp-line", "visibility", "none");
        map.setLayoutProperty("predevelopment-rfp-line", "visibility", "none");
        map.setLayoutProperty("in-construction-rfp-line", "visibility", "none");
        map.setLayoutProperty("completed-rfp-line", "visibility", "none");
        /*map.setLayoutProperty("vacant-commercial", "visibility", "none");
                                map.setLayoutProperty("vacant-multi", "visibility", "none");
                                map.setLayoutProperty("vacant-land", "visibility", "none");*/
        map.setLayoutProperty("residential-permits", "visibility", "none");
        map.setLayoutProperty("one-million", "visibility", "none");
        map.setLayoutProperty("twenty-five-million", "visibility", "none");
        //map.setLayoutProperty("over-twenty-five-million", "none", "none");
      }
      //Public Assets - off
      else if (this_source === "public-assets") {
        map.setLayoutProperty("dlba-structures", "visibility", "none");
        map.setLayoutProperty("dlba-vacant-lots", "visibility", "none");
        map.setLayoutProperty("dlba-auctions", "visibility", "none");
        map.setLayoutProperty("dlba-side-lots", "visibility", "none");
        map.setLayoutProperty("dlba-rehabbed-and-ready", "visibility", "none");
        map.setLayoutProperty("dlba-own-it-now", "visibility", "none");
        map.setLayoutProperty("marketed-properties", "visibility", "none");
        map.setLayoutProperty("tax-status-city-owned-properties", "visibility", "none");
        map.setLayoutProperty("parksgeojson", "visibility", "none");
      }
      //QLine - off
      else if (this_source === "qline") {
        map.setLayoutProperty("qlinestops", "visibility", "none");
        map.setLayoutProperty("qlineroute", "visibility", "none");
      }
      //Bus - off
      else if (this_source === "bus") {
        map.setLayoutProperty("ddotroutes", "visibility", "none");
        map.setLayoutProperty("smartroutes", "visibility", "none");
      }
      //Public Transportation - off
      else if (this_source === "public-transportation") {
        map.setLayoutProperty("ddotroutes", "visibility", "none");
        map.setLayoutProperty("smartroutes", "visibility", "none");
        map.setLayoutProperty("qlinestops", "visibility", "none");
        map.setLayoutProperty("qlineroute", "visibility", "none");
        map.setLayoutProperty("mogobikes", "visibility", "none");
        map.setLayoutProperty("peoplemover", "visibility", "none");
      }
      //Permits - off
      else if (this_source === "building-permits") {
        map.setLayoutProperty("residential-permits", "visibility", "none");
        map.setLayoutProperty("one-million", "visibility", "none");
        map.setLayoutProperty("twenty-five-million", "visibility", "none");
        //map.setLayoutProperty("over-twenty-five-million", "none", "none");
      } else if (this_source === "commercial-permits") {
        map.setLayoutProperty("one-million", "visibility", "none");
        map.setLayoutProperty("twenty-five-million", "visibility", "none");
        //map.setLayoutProperty("over-twenty-five-million", "none", "none");
      }

      //Zoning - off
      else if (this_source === "zoning") {
        zoning_filter = [];
        filterDataset("zoning", "in", "zoning_rev", zoning_filter);
      } else if ($(this).hasClass("zoning-checkbox")) {
        if ($(this).hasClass("zoning-header")) {
          var isHeader = true;
        }
        $(".zoning-checkbox").each(function(index, element) {
          //console.log(zoning_filter);
          if (!$(this).is(":checked")) {
            //console.log($(this).attr('id') + " is not checked");
            if ($(this).hasClass("zoning-header") && isHeader) {
              $(this)
                .siblings("ul")
                .children("li")
                .children("input")
                .each(function() {
                  var removeItem = $(this).attr("id");
                  //console.log("Removing: " + removeItem);
                  var index = zoning_filter.indexOf(removeItem);
                  if (index !== -1) zoning_filter.splice(index, 1);
                });
            } else {
              //console.log($(this).attr('id'));
              var removeItem = $(this).attr("id");
              var index = zoning_filter.indexOf(removeItem);
              if (index !== -1) zoning_filter.splice(index, 1);
              //console.log(zoning_filter);
            }
          }
        });
        filterDataset("zoning", "in", "zoning_rev", zoning_filter);
      }

      //All other layers - off
      else {
        map.setLayoutProperty(this_source, "visibility", "none");
      }
    }
  });
  function getPermitInfo(permits) {
    var permitParcel, bldPermitDesc, permitEstCost, permitIssueDate, permitExpireDate, permitNo, permitStatus, permitType, permitLabel, permitInfo;
    $("#map-sidebar-info .permit-data").empty();
    for (var i = 0; i < permits.length; i++) {
      for (var field in permits[i]) {
        //console.log(field);
        if (field == "parcel_no") {
          if (permits[i][field].length > 0) {
            permitLabel = "Permit Parcel No";
            permitParcel = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permits[i][field] + "</p>";
          }
        }
        if (field == "permit_no") {
          if (permits[i][field].length > 0) {
            permitLabel = "Permit No";
            permitNo = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permits[i][field] + "</p>";
          }
        }
        if (field == "bld_permit_desc") {
          if (permits[i][field].length > 0) {
            permitLabel = "Permit Description";
            bldPermitDesc = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permits[i][field] + "</p>";
          }
        }
        if (field == "estimated_cost") {
          if (permits[i][field].length > 0) {
            permitLabel = "Estimated Cost";
            permitEstCost = parseInt(permits[i][field]);
            permitEstCost = '<span class="dollar-sign">$</span>' + permitEstCost.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            permitEstCost = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permitEstCost + "</p>";
          }
        }
        if (field == "permit_issued") {
          if (permits[i][field].length > 0) {
            permitLabel = "Permit Issue Date";
            permits[i][field] = new Date(permits[i][field]);
            var d = permits[i][field];
            d = d.toString();
            d = d.split(" ");
            d = d[1] + " " + d[2] + ", " + d[3];
            permits[i][field] = d;
            permitIssueDate = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permits[i][field] + "</p>";
          }
        }
        if (field == "permit_expire") {
          if (permits[i][field].length > 0) {
            permitLabel = "Permit Expiration Date";
            permits[i][field] = new Date(permits[i][field]);
            var d = permits[i][field];
            d = d.toString();
            d = d.split(" ");
            d = d[1] + " " + d[2] + ", " + d[3];
            permits[i][field] = d;
            permitExpireDate =
              '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permits[i][field] + "</p>";
          }
        } /*
                                if (field == 'permit_status') {
                                    permitLabel = "Permit Status"
                                    permitStatus = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ':</span> ' + permits[field] + '</p>';
                                }*/
        if (field == "residential") {
          if (permits[i][field].length > 0) {
            permitLabel = "Permit Type";
            permitType = '<p data-field="' + field + '"><span class="field-label">' + permitLabel.toUpperCase() + ":</span> " + permits[i][field] + "</p>";
          }
        }
      }

      $("#map-sidebar-info .permit-data").append(permitNo, permitParcel, bldPermitDesc, permitEstCost, permitIssueDate, permitExpireDate, permitType, "<hr/>");
    }
    $("#map-sidebar-info .permit-data").prepend("<h5><span>Open Building Permits</span></h5>");
  }
  function getParcelInfo(cleanParcelId, long, lat) {
    $("#map-sidebar-info").hide();
    $("#loadscreen").show();
    $.when(
      // Get the HTML
      $.get(`https://apis.detroitmi.gov/assessments/parcel/${cleanParcelId}/?format=json`, function(parcelPointsOwnership) {}, "json"),
      $.get(
        "https://services2.arcgis.com/HsXtOCMp1Nis1Ogr/arcgis/rest/services/MCM_10012014_Enhanced/FeatureServer/0/query?where=CityParcelID2013%3D%27" +
          cleanParcelId +
          "%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=Photo_URL%2C+Occupancy&returnGeometry=false&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=",
        function(occupancy) {},
        "json"
      ),
      $.get(
        `https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DLBA_Owned_Properties/FeatureServer/0/query?where=parcel_id%3D%27${cleanParcelId}%27&outFields=*&f=json`,
        function(dlbaInventory) {},
        "json"
      ),
      $.get(
        `https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DLBA_For_Sale/FeatureServer/0/query?where=parcel_id%3D%27${cleanParcelId}%27&outFields=*&outSR=4326&f=json`,
        function(dlbaProgram) {},
        "json"
      ),
      $.get(
        `https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Completed_Residential_Demolitions/FeatureServer/0/query?where=parcel_id%3D%27${cleanParcelId}%27&outFields=*&outSR=4326&f=json`,
        function(demolished) {},
        "json"
      )
      // $.get("https://data.detroitmi.gov/resource/uzpg-2pfj.json?$select=parcel_id,demolition_date&parcel_id=%27" + cleanParcelId + "%27", function(demolished) {}, 'json'),
      // $.get("https://data.detroitmi.gov/resource/hww8-8shf.json?pid=%27" + cleanParcelId + "%27", function(marketedPropStatus) { }, 'json'),
      // $.get('https://data.detroitmi.gov/resource/but4-ky7y.json?$where=permit_issued%3E%22' + permitDate + '%22%20AND%20permit_status=%22OPEN%22AND%20parcel_no=%22' + cleanParcelId + "%22", function(buildingPermits) {}, 'json'),
      // $.get('https://data.detroitmi.gov/resource/ibmm-yi2w.json?$where=parcelno=%22'+cleanParcelId+'%22', function(mcmReturn) {}, 'json'),
      // $.get('https://data.detroitmi.gov/resource/f3fy-ksxq.json?$where=parcelno=%22'+cleanParcelId+'%22', function(mcrReturn) {}, 'json'),
      // $.get('https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/rosaparks_clairmount_mf/FeatureServer/0/query?where=apn+%3D+%27'+cleanParcelId+'%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=', function(vacantMultiFamily) {}, 'json')
    ).then(function loadParcelInfo(
      parcelPointsOwnership,
      occupancy,
      dlbaInventory,
      dlbaProgram,
      demolished
      // marketedPropStatus, buildingPermits, mcmReturn, mcrReturn, vacantMultiFamily
    ) {
      var allowedToShow;
      if (parcelPointsOwnership[0].length === 0 && lat && long) {
        $("#map-sidebar-info").hide();
        $("#loadscreen").show();
        allowedToShow = true;
        $.getJSON("https://data.detroitmi.gov/resource/tk3f-vp8k.json?$where=intersects(the_geom, 'POINT (" + long + " " + lat + ")')", function(data) {
          //console.log(data[0].parcelnum);
          try {
            map.setFilter("parcel-fill-hover", ["==", "parcelnum", data[0].parcelnum]);
            getParcelInfo(data[0].parcelnum);
            return;
          } catch (e) {
            $(".map-sidebar-header").text("NO MATCH FOUND");
            $(".key-data").text("That address does not match a property in our database.");
            $("#loadscreen").hide();
            $("#map-sidebar-info").show();
            return;
          }
        });
      } else {
        allowedToShow = true;
      }
      map.setFilter("parcel-fill-hover", ["==", "parcelno", cleanParcelId]);
      //empty sidebard and prepare sections
      $(".map-sidebar-header, .occupancy-data, .key-data, .additional-data, .mcr-data, .mcm-data").empty();

      //declare variables to be used in data sidebar
      var address,
        building_type,
        buy_property_btn,
        buy_property_btn_class,
        buy_property_btn_label,
        buy_property_btn_url,
        clean_address,
        council_district,
        demolition_date,
        depth,
        dlba_address,
        electric,
        frontage,
        gas,
        label,
        land_value,
        last_sale_date,
        last_sale_price,
        legaldesc,
        occupancy_status,
        num,
        occupancy_status_color,
        owner,
        owner_address,
        parcelnum,
        pre,
        program_type,
        property_address,
        sev,
        sqft,
        taxable_status,
        taxable_status_token,
        taxable_value,
        total_acres,
        utilities,
        ward,
        water,
        year_built,
        zip_code,
        zoning;

      var occupancyDisclaimer =
        "<!--p><sup><sup class='disclaimer'>0</sup> Vacancy Data and Parcel Image are provided through Data Driven Detroit's Open Data Portal. Information is accurate as of Fall 2013. Demolition Data is provided through Detroit's Open Data Portal, accurate as of " +
        mm +
        "/" +
        dd +
        "/" +
        (yyyy + 1) +
        "</sup></p-->";
      var assessorsDisclaimer =
        '<p><sup><sup class="disclaimer">1</sup> City Owned Property data is sourced from the City of Detroit’s Office of the Assessor. If you find any discrepancies please visit the Coleman A. Young Municipal Center at 2 Woodward Avenue - Suite 804 Detroit, Michigan 48226 or call (313) 224-3035</sup></p>';
      var cityOwnedDisclaimer =
        '<p><sup>Please note: For the most accurate information for City of Detroit owned land that is available for sale <a href="http://summitcommercialllc.catylist.com/search/" target="_blank">please contact Summit Commercial here</a>.</sup></p>';

      //go thru each field in parcel, create label, and append create variables to append
      parcelPointsOwnership = parcelPointsOwnership[0];
      for (var field in parcelPointsOwnership) {
        if (parcelPointsOwnership.hasOwnProperty(field)) {
          if (field == "propaddr") {
            $(".map-sidebar-header").text(parcelPointsOwnership[field]);
            address = parcelPointsOwnership[field];
            clean_address = parcelPointsOwnership[field];
            property_address = parcelPointsOwnership[field];
          }
          if (field == "ressytle") {
            label = "Building Type";
            building_type =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "council") {
            label = "Council District";
            council_district =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "depth") {
            label = "Depth";
            depth = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "frontage") {
            label = "Frontage";
            frontage = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "landvalue" && parseInt(parcelPointsOwnership[field]) > 0) {
            label = "Land Value";
            num = parcelPointsOwnership[field];
            num = parseInt(num);
            parcelPointsOwnership[field] = '<span class="dollar-sign">$</span>' + num.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            land_value = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "saledate") {
            parcelPointsOwnership[field] = new Date(parcelPointsOwnership[field]);
            var d = parcelPointsOwnership[field];
            d = d.toString();
            d = d.split(" ");
            d = d[1] + " " + d[2] + ", " + d[3];
            parcelPointsOwnership[field] = d;
            label = "Last Sale Date";
            last_sale_date =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "saleprice" && parseInt(parcelPointsOwnership[field]) > 0) {
            label = "Last Sale Price";
            num = parcelPointsOwnership[field];
            num = parseInt(num);
            parcelPointsOwnership[field] = '<span class="dollar-sign">$</span>' + num.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            last_sale_price =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "legaldesc") {
            label = "Legal Description";
            legaldesc = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "taxpayer1") {
            label = "Owner";
            owner = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "taxpcity") {
            owner_address = parcelPointsOwnership[field];
          }
          if (field == "taxpstate") {
            owner_address = owner_address + ", " + parcelPointsOwnership[field];
          }
          if (field == "taxpaddr") {
            owner_address = parcelPointsOwnership[field] + ", " + owner_address;
          }
          if (field == "taxpzip") {
            label = "Owner Address";
            owner_address = owner_address + ", " + parcelPointsOwnership[field];
            parcelPointsOwnership[field] = owner_address;
            owner_address =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "parcelno") {
            label = "Parcel Number";
            parcelnum = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "pre") {
            label = "Principal Residence Exemption";
            pre = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "sev" && parseInt(parcelPointsOwnership[field]) > 0) {
            label = "State Equalized Value";
            num = parcelPointsOwnership[field];
            num = parseInt(num);
            parcelPointsOwnership[field] = '<span class="dollar-sign">$</span>' + num.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            sev = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "resflarea") {
            label = "Square Footage";
            num = parcelPointsOwnership[field];
            num = num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
            parcelPointsOwnership[field] = num;
            sqft =
              '<p data-field="' +
              field +
              '"><span class="field-label">' +
              label.toUpperCase() +
              ":</span> " +
              parcelPointsOwnership[field] +
              "<sup>2</sup></p>";
          }
          if (field == "taxstatus") {
            label = "Taxable Status";
            taxable_status_token = parcelPointsOwnership[field];
            taxable_status =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "txv" && parseInt(parcelPointsOwnership[field]) > 0) {
            label = "Taxable Value";
            num = parcelPointsOwnership[field];
            num = parseInt(num);
            parcelPointsOwnership[field] = '<span class="dollar-sign">$</span>' + num.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            taxable_value =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "totalacreage") {
            label = "Total Acreage";
            taxable_value =
              '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "ward") {
            label = "Ward";
            ward = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "resyrbuilt" && parseInt(parcelPointsOwnership[field]) > 0) {
            label = "Year Built";
            year_built = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
          if (field == "zipcode") {
            label = "Property Address";
            property_address =
              '<p data-field="property_address"><span class="field-label">' +
              label.toUpperCase() +
              ":</span> " +
              property_address +
              ", DETROIT, MI, " +
              parcelPointsOwnership[field] +
              "</p>";
          }
          if (field == "zoning") {
            label = "Zoning";
            zoning = '<p data-field="' + field + '"><span class="field-label">' + label.toUpperCase() + ":</span> " + parcelPointsOwnership[field] + "</p>";
          }
        }
      }

      function createSVGIcons() {
        electric =
          '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" data-author="Created by Yu luck from the Noun Project" viewBox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><g><g><polygon fill="#FDD023" points="34.82574,91 44,56 25,56 47,15 67,15 53,41 75,41   "/></g></g></svg>';
        gas =
          '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" data-author="Created by Ron Scott from the Noun Project" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100; fill: dodgerblue;" xml:space="preserve"><path d="M82.5,62.2c-1.3-5-6.7-13.4-9.8-17.9c0.1,0.5,1.1,4.3,1.4,6.5c0.5,3.5-0.6,6.7-3.3,9.4C69,62,67,63.6,64.7,64.9  c-3.9,2.1-7.8,4.3-11.8,6.3C49.8,72.8,48,75,47.5,78c-0.6,3.7-0.2,7.4,0.9,11.1c0.4,1.4,0.8,2.9,1.2,4.3c-3.9-4.3-7.4-8.6-9.7-13.7  c-3-6.5-0.7-13.5,6.3-17.8c4-2.5,7.9-5,12-7.5c7.1-4.2,12-14.7,8.2-23c-3.2-7-8.1-13-14.8-18c-3.9-2.9-7.6-5.9-12-8.3  c0.5,1.1,4,9.4,4,13c0,6-2.3,11.4-5.7,16.6c-3.7,5.6-8.1,11-11.7,16.7c-7.6,12.2-4.4,25.9,7.9,35c4.7,3.5,10,6.2,15.8,8.4  c0.1,0,0.2,0,0.4,0c1.4-4.7,5.1-7.6,10.3-9.5c2.8-1,5.4-2.2,8.1-3.3c3.2-1.3,6.1-3.1,8.8-5C80.1,75.1,84.5,69.7,82.5,62.2z"/></svg>';
        water =
          '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.2" data-author="Created by Aleks from the Noun Project" baseProfile="tiny" x="0px" y="0px" viewBox="0 0 100 125" xml:space="preserve" style="fill: cornflowerblue;"><g><path d="M50,5c-1.381,0-2.5,1.119-2.5,2.5c0,6.081-5.483,13.712-11.288,21.79C28.613,39.867,20,51.854,20,65   c0,20.724,15.067,30,30,30s30-9.276,30-30c0-13.146-8.613-25.133-16.212-35.71C57.983,21.212,52.5,13.581,52.5,7.5   C52.5,6.119,51.381,5,50,5z M50,85c-9.668,0-20-5.254-20-20c0-1.381,1.119-2.5,2.5-2.5S35,63.619,35,65c0,13.538,10.49,15,15,15   c1.381,0,2.5,1.119,2.5,2.5S51.381,85,50,85z"/></g></svg>';
      }
      //createSVGIcons();

      //test for landbank status
      var isDlba = dlbaInventory[0].features.length ;
      var isDemolished = demolished[0].features.length;
      var isDlbaProgram = dlbaProgram[0].features.length;
      if (isDlba) {
        var dlbaInventoryStatus = dlbaInventory[0].features[0].attributes.inventory_status_socrata;
      }

      // if property is demolished, append demo date
      if (isDemolished > 0) {
        demolition_date = demolished[0].features[0].attributes.demolition_date;
        demolition_date = new Date(demolition_date);
        var d = demolition_date;
        d = d.toString();
        d = d.split(" ");
        d = d[1] + " " + d[2] + ", " + d[3];
        demolition_date = d;
        label = "Demolition Date";
        demolition_date = '<p data-field="demolition_date"><span class="field-label">' + label.toUpperCase() + ":</span> " + demolition_date + "</p>";
      }

      //if land bank, determine program type to append to list
      if (isDlba > 0) {
        if (isDlbaProgram) {
          program_type = dlbaProgram[0].features[0].attributes.program;
          dlba_address = dlbaProgram[0].features[0].attributes.address;
          dlba_address = dlba_address.split(" ").join("+");
          if (program_type === "Auction") {
            buy_property_btn_url = "https://buildingdetroit.org/properties?category=&property_choose=on&location=" + dlba_address;
            buy_property_btn_class = "dlba-auction";
            buy_property_btn_label = "View This Property";
          }
          if (program_type === "Own It Now") {
            buy_property_btn_url = "https://buildingdetroit.org/properties?category=&property_choose=on&location=" + dlba_address;
            buy_property_btn_class = "dlba-own-it-now";
            buy_property_btn_label = "View This Property";
          }
          if (program_type === "Rehabbed and Ready") {
            buy_property_btn_url = "https://buildingdetroit.org/properties?category=&property_choose=on&location=" + dlba_address;
            buy_property_btn_class = "dlba-rehabbed-and-ready";
            buy_property_btn_label = "View This Property";
          }

          buy_property_btn =
            '<a class="property-app-link" target="_blank" href=' +
            buy_property_btn_url +
            '><span data-program=' +
            program_type +
            '>' +
            buy_property_btn_label +
            "</span></a>";
          label = "Detroit Land Bank Program";
          program_type = '<p data-field=""><span class="field-label">' + label.toUpperCase() + ":</span> " + program_type + "</p>";
        } else if (dlbaInventoryStatus === "DLBA Owned Sidelot For Sale") {
          dlba_address = clean_address;
          dlba_address = dlba_address.split(" ").join("+");
          program_type = dlbaInventoryStatus;
          label = "Detroit Land Bank Program";
          buy_property_btn_url = "https://buildingdetroit.org/sidelots?category=&property_choose=on&location=" + dlba_address;
          buy_property_btn_label = "Buy this Sidelot";
          buy_property_btn_class = "dlba-sidelot";
          buy_property_btn =
            '<a class="property-app-link" target="_blank" href=' +
            buy_property_btn_url +
            '><span data-program=' +
            program_type +
            '>' +
            buy_property_btn_label +
            "</span></a>";
          program_type = '<p data-field=""><span class="field-label">' + label.toUpperCase() + ":</span> " + program_type + "</p>";
        } else {
          label = "Detroit Land Bank Program";
          program_type = dlbaInventoryStatus;
          program_type = '<p data-field=""><span class="field-label">' + label.toUpperCase() + ":</span> " + program_type + "</p>";
          buy_property_btn_url =
            "http://app.detroitmi.gov/PropertyApplicationForm" /*'https://juancatothe.github.io/commercial_property_wizard/?reference=Detroit_Development&address=' + dlba_address*/;
          buy_property_btn_label = "Inquire to Buy This Property";
          buy_property_btn_class = "dlba-not-marketed";
          buy_property_btn = '<a class="property-app-link" target="_blank" href=' + buy_property_btn_url + '>' + buy_property_btn_label + "</span></a>";
        }
        console.log(buy_property_btn_url)
        console.log(buy_property_btn)
      }
      // if(taxable_status_token === "CITY OWNED"|| (vacantMultiFamily[0].features.length>0 && vacantMultiFamily[0].features[0].attributes.Owner === "PDD")||(vacantMultiFamily[0].features.length>0 && vacantMultiFamily[0].features[0].attributes.Owner === "DLBA")){
      //         buy_property_btn_url = 'http://app.detroitmi.gov/PropertyApplicationForm'/*'https://juancatothe.github.io/commercial_property_wizard/?reference=Detroit_Development&address=' + dlba_address*/;
      //         buy_property_btn_label = 'Inquire to Buy This Property'
      //         buy_property_btn_class = 'marketed-properties';
      //         buy_property_btn = '<a class="property-app-link" target="_blank" href="' + buy_property_btn_url + '"><span>' + buy_property_btn_label + '</span></a>';
      // }
      // try{
      //         if(marketedPropStatus[0][0].property_type === "NOT FOR SALE"){
      //             buy_property_btn = '';
      //     }else{
      //         var str = address;
      //         var address = str.split(' ').join('+');
      //         buy_property_btn_url =
      //         'http://summitcommercialllc.catylist.com/jsp/search/results.jsp?street1='+address+'&submit_searchid=Go#p=1,50|s=CITY,0|c=street1:'+address+';search2:true;propertyType:;subtype:;groupSuites:1;|ac=StreetAddress,Keyword,Location:[],PropertyType,UseType,SalePrice,LeasePrice,Size,SaleLease|gs=1|h=|tl=Page%201|hid=0|';
      //         buy_property_btn_label = 'Inquire to Buy This Property'
      //         buy_property_btn_class = 'marketed-properties';
      //         buy_property_btn = '<a class="property-app-link '+buy_property_btn_class+'" target="_blank" href="' + buy_property_btn_url + '"><span>' + buy_property_btn_label + '</span></a>';
      //     }
      //     }catch(e){
      //        //console.log("YO",e)
      //     }

      //get occupancy status and street image
      if (!occupancy[0].features[0] || occupancy[0].features[0].attributes.Occupancy === null) {
        occupancy_status = "";
        occupancy_status = "";
        utilities = "";
      } else {
        if (occupancy[0].features[0].attributes.Occupancy == "occupied") {
          occupancy_status = "Likely Occupied";
          occupancy_status_color = "#B33A3A";
          utilities = water + electric + gas;
        }
        if (occupancy[0].features[0].attributes.Occupancy == "maybe") {
          occupancy_status = "Possibly Occupied";
          occupancy_status_color = "#FFCC00";
          utilities = "";
        }
        if (occupancy[0].features[0].attributes.Occupancy == "unoccupied") {
          occupancy_status = "Likely Unoccupied";
          occupancy_status_color = "#009900";
          utilities = "";
        }
        if (!occupancy[0].features[0].attributes.Occupancy || isDemolished > 0) {
          occupancy_status = "Likely Vacant Lot";
          occupancy_status_color = "#009900";
          utilities = "";
        }
        if (isDlba > 0 || isDlbaProgram > 0) {
          if (dlbaInventoryStatus === "DLBA Owned Sidelot For Sale") {
            occupancy_status = "Likely Vacant Lot";
            occupancy_status_color = "#009900";
          } else {
            occupancy_status = "Likely Unoccupied";
            occupancy_status_color = "#009900";
          }
        }
        occupancy_status =
          '<!--p data-field="Occupancy" class="occupancy"><span class="occupancy-status-color"  style=background:' +
          occupancy_status_color +
          '></span><span class="occupancy-status" data-field="' +
          occupancy_status +
          '">' +
          occupancy_status +
          '</span><sup class="disclaimer">0</sup></p-->';
        var parcelImage;
        if (occupancy[0].features[0].attributes.Photo_URL) {
          parcelImage = occupancy[0].features[0].attributes.Photo_URL;
          parcelImage = '<div data-field="Photo_URL" class="frame"><img alt="Photo of" src=' + parcelImage + '></div>';
        }
      }
      //append information to sidebar
      $("#map-sidebar-info .occupancy-data").append(buy_property_btn, parcelImage, occupancy_status);
      $("#map-sidebar-info .key-data").append(
        '<h5><span>Key Data<sup class="disclaimer">1</sup></span></h5>',
        program_type,
        property_address,
        demolition_date,
        owner,
        owner_address,
        zoning,
        council_district
      );
      $("#map-sidebar-info .additional-data").append(
        "<h5><span>Additional Data</span></h5>",
        last_sale_date,
        last_sale_price,
        year_built,
        parcelnum,
        sev,
        taxable_status,
        land_value,
        taxable_value,
        pre,
        total_acres,
        frontage,
        depth,
        sqft,
        ward,
        legaldesc,
        "<br><br>",
        occupancyDisclaimer,
        assessorsDisclaimer
      );

      // if(marketedPropStatus[0].length>0 || taxable_status_token === "CITY OWNED"){
      //     $('#map-sidebar-info .additional-data').append(cityOwnedDisclaimer);
      // }

      // if(mcmReturn[0].length>0){
      //     var address, business, bizDesc, bizURL, track;
      //     var mcmBusiness = mcmReturn[0];
      //     for (var i = 0; i < mcmBusiness.length; i++) {
      //         for (var field in mcmBusiness[i]) {
      //             if (mcmBusiness[i].hasOwnProperty(field)) {
      //                 if (field == 'business_address') {
      //                     if(i>0){
      //                         address = mcmBusiness[i][field] + ", " + address;
      //                     }else{
      //                         address = mcmBusiness[i][field];
      //                     }
      //                 }
      //                 if (field == 'business') {
      //                     business = mcmBusiness[i][field];
      //                 }
      //                 if (field == 'description') {
      //                     bizDesc = mcmBusiness[i][field];
      //                 }
      //                 if (field == 'url') {
      //                     bizURL = mcmBusiness[i][field];
      //                 }
      //             }
      //         }
      //     }
      //     $('#map-sidebar-info .mcm-data').prepend('<h5><span>Motor City Match</span></h5>');
      //     $('#map-sidebar-info .occupancy').remove();
      //     $('#map-sidebar-info .occupancy-data').append('<!--p data-field="Occupancy" class="occupancy"><span class="occupancy-status-color"  style="background: #B33A3A"></span><span class="occupancy-status">Likely Occupied</span><sup class="disclaimer">0</sup></p-->');
      //     $('.mcm-data').append('<p class="mc-business">' + business + '</p>');
      //     $('.mcm-data').append('<p class="mc-business-address">' + address + '</p>');
      //     if(bizURL){
      //         if(bizURL != "N/A"){$('.mcm-data').append('<p><a class="mc-business-link" href="' + bizURL + '" alt="' + business + ' Website Link" target="_blank">Website</a></p>')};
      //        }
      //     $('.mcm-data').append('<p>' + bizDesc + '</p>');
      //     $('.mcm-data').show();
      // }

      // if(mcrReturn[0].length>0){
      //     var address, business, bizDesc, bizURL, track;
      //     var mcRestore = mcrReturn[0];
      //     for (var i = 0; i < mcRestore.length; i++) {
      //         for (var field in mcRestore[i]) {
      //             if (mcRestore[i].hasOwnProperty(field)) {
      //                 if (field == 'track') {
      //                     if(i>0){
      //                         track = mcRestore[i][field] + ", " + track;
      //                     }else{
      //                         track = mcRestore[i][field];
      //                     }
      //                 }
      //                 if (field == 'business_address') {
      //                     if(i>0){
      //                         address = mcRestore[i][field] + ", " + address;
      //                     }else{
      //                         address = mcRestore[i][field];
      //                     }
      //                 }
      //                 if (field == 'business') {
      //                     business = mcRestore[i][field];
      //                 }
      //                 if (field == 'description') {
      //                     bizDesc = mcRestore[i][field];
      //                 }
      //                 if (field == 'website') {
      //                     bizURL = mcRestore[i][field];
      //                 }
      //             }
      //         }
      //     }
      //     $('#map-sidebar-info .mcr-data').prepend('<h5><span>Motor City Restore</span></h5>');
      //     $('.mcr-data').append('<p class="mc-business">' + business + '</p>');
      //     if(bizURL || bizURL != "N/A"){$('.mcr-data').append('<p><a class="mc-business-link" href="' + bizURL + '" alt="' + business + ' Website Link" target="_blank">Website</a></p>')};
      //     $('.mcr-data').append('<p>' + bizDesc + '</p>');
      //     $('.mcr-data').append('<p><span class="field-label">Award Type: </span>' + track + '</p>');
      //     $('.mcr-data').append('<p><span class="field-label">Business Address: </span>' + address + '</p>');
      //     $('.mcr-data').show();
      // }

      // if(vacantMultiFamily[0].features.length>0){
      //     var owner, resource;
      //     if(vacantMultiFamily[0].features[0].attributes.Owner === "PDD"||vacantMultiFamily[0].features[0].attributes.Owner === "DLBA"){
      //         resource = 'Resources for Potential Buyers: <br><br>Click button above to inquire to purchase property.<br><br>Learn more about tax and financial incentives for rehabilition <a target="_self" href="http://detroitmi.gov/Detroit-Opportunities/Detroit-Development/Detroit-Development-Financing">here</a>.'
      //     }else{
      //         resource = 'Resources for Owners: <br><br>Click <a target="_blank" href="http://detroitmi.gov/Detroit-Opportunities/Detroit-Development/How-To-Develop-in-Detroit#vacant-multifamily">here</a> for tax and financial incentives.'
      //     }
      //     $('#map-sidebar-info .mcr-data').prepend('<h5><span>Vacant Multifamily</span></h5>');
      //     $('.mcr-data').append('<p class="vacant-resource">' + resource + '</p>');
      //     $('.mcr-data').show();
      // }

      // if(buildingPermits[0].length>0){
      //     //get Permits Info
      //     getPermitInfo(buildingPermits[0]);
      //     $('.permit-data').show();
      // }else{
      //     $('.permit-data').hide();
      // }

      if (allowedToShow) {
        $("#loadscreen").hide();
        $("#map-sidebar-info").show();
      }
    });
  }

  var mapSectionClickModule = (function() {
    map.on("click", function(e) {
      function showLoadScreen() {
        $("#map-sidebar-info").hide();
        $("#loadscreen").show();
      }
      showLoadScreen();
      var parcelFeatures = null;
      var residentialPermitFeatures = null;
      var oneMillionPermitFeatures = null;
      var twentyFiveMillionPermitFeatures = null;
      var overTwentyFiveMillionPermitFeatures = null;
      var snfAreasFeatures = null;
      var planningAreasFeatures = null;
      var completedPlanningAreasFeatures = null;
      var targetedMultiFamilyFeatures = null;
      var marketedPropFeatures = null;
      var taxStatusCityFeatures = null;
      var cleanParcelId = null;
      var mcmBusinessFeatures = null;
      var mcRestoreFeatures = null;
      var inConstructionRFPFeatures = null;
      var openRFPFeatures = null;
      var predevelopmentRFPFeatures = null;
      var completedRFPFeatures = null;
      try {
        // residentialPermitFeatures = map.queryRenderedFeatures(e.point, { layers: ['residential-permits'] });
        // oneMillionPermitFeatures = map.queryRenderedFeatures(e.point, { layers: ['one-million'] });
        // twentyFiveMillionPermitFeatures = map.queryRenderedFeatures(e.point, { layers: ['twenty-five-million'] });
        //overTwentyFiveMillionPermitFeatures = map.queryRenderedFeatures(e.point, { layers: ['over-twenty-five-million'] });
        // snfAreasFeatures = map.queryRenderedFeatures(e.point, { layers: ['snf-fill'] });
        // planningAreasFeatures = map.queryRenderedFeatures(e.point, { layers: ['planning-areas-fill'] });
        // completedPlanningAreasFeatures = map.queryRenderedFeatures(e.point, { layers: ['completed-planning-projects-fill'] });
        parcelFeatures = map.queryRenderedFeatures(e.point, { layers: ["parcel-fill"] });
        // marketedPropFeatures = map.queryRenderedFeatures(e.point, { layers: ['marketed-properties'] });
        // taxStatusCityFeatures = map.queryRenderedFeatures(e.point, { layers: ['tax-status-city-owned-properties']});
        mcmBusinessFeatures = map.queryRenderedFeatures(e.point, { layers: ["mcm-business"] });
        mcRestoreFeatures = map.queryRenderedFeatures(e.point, { layers: ["mc-restore"] });
        inConstructionRFPFeatures = map.queryRenderedFeatures(e.point, { layers: ["in-construction-rfp-fill"] });
        openRFPFeatures = map.queryRenderedFeatures(e.point, { layers: ["open-rfp-fill"] });
        predevelopmentRFPFeatures = map.queryRenderedFeatures(e.point, { layers: ["predevelopment-rfp-fill"] });
        completedRFPFeatures = map.queryRenderedFeatures(e.point, { layers: ["completed-rfp-fill"] });
        targetedMultiFamilyFeatures = map.queryRenderedFeatures(e.point, { layers: ["targeted-multi-family-fill"] });
      } catch (error) {
        //console.log(error);
        alert("error");
      } finally {
        if (parcelFeatures.length > 0) {
          //console.log(parcelFeatures);
          cleanParcelId = parcelFeatures[0].properties.parcelno /*.replace(/       \./g,'_')*/;
          if (cleanParcelId) {
            getParcelInfo(cleanParcelId);
          }
        } else if (mcmBusinessFeatures.length > 0 || mcRestoreFeatures.length > 0) {
          if (mcmBusinessFeatures.length > 0) {
            getParcelInfo(mcmBusinessFeatures[0].properties.parcelno);
            flyTo(mcmBusinessFeatures[0].geometry.coordinates[0], mcmBusinessFeatures[0].geometry.coordinates[1], 16);
          }
          if (mcRestoreFeatures.length > 0) {
            getParcelInfo(mcRestoreFeatures[0].properties.parcelno);
            flyTo(mcRestoreFeatures[0].geometry.coordinates[0], mcRestoreFeatures[0].geometry.coordinates[1], 16);
          }
        } else if (
          snfAreasFeatures.length > 0 ||
          planningAreasFeatures.length > 0 ||
          completedPlanningAreasFeatures.length > 0 ||
          targetedMultiFamilyFeatures.length > 0 ||
          inConstructionRFPFeatures.length > 0 ||
          openRFPFeatures.length > 0 ||
          predevelopmentRFPFeatures.length > 0 ||
          completedRFPFeatures.length > 0
        ) {
          var polygonArea,
            areaProperties,
            projDesc,
            projEntity,
            projImage,
            projLink,
            projMapStatus,
            projNotes,
            projPlanning_1,
            projPlanning_A,
            projName,
            projSNF,
            projSt,
            projStatus,
            residentialPermitsCount,
            oneMillionPermitsCount,
            twentyFiveMillionPermitsCount,
            overTwentyFiveMillionPermitsCount,
            cityOwnedParcelsCount,
            parksCount,
            commercialPermitsCount,
            landBankStructureCount,
            mcmBusinessCount,
            mcrCount;
          var areaPermitsCount = 0;
          if (snfAreasFeatures.length > 0) {
            polygonArea = snfAreasFeatures[0];
            areaProperties = snfAreasFeatures[0].properties;
          } else if (planningAreasFeatures.length > 0) {
            polygonArea = planningAreasFeatures[0];
            areaProperties = planningAreasFeatures[0].properties;
          } else if (completedPlanningAreasFeatures.length > 0) {
            polygonArea = completedPlanningAreasFeatures[0];
            areaProperties = completedPlanningAreasFeatures[0].properties;
          } else if (targetedMultiFamilyFeatures.length > 0) {
            polygonArea = targetedMultiFamilyFeatures[0];
            areaProperties = targetedMultiFamilyFeatures[0].properties;
          } else if (inConstructionRFPFeatures.length > 0) {
            polygonArea = inConstructionRFPFeatures[0];
            areaProperties = inConstructionRFPFeatures[0].properties;
          } else if (predevelopmentRFPFeatures.length > 0) {
            polygonArea = predevelopmentRFPFeatures[0];
            areaProperties = predevelopmentRFPFeatures[0].properties;
          } else if (openRFPFeatures.length > 0) {
            polygonArea = openRFPFeatures[0];
            areaProperties = openRFPFeatures[0].properties;
          } else if (completedRFPFeatures.length > 0) {
            polygonArea = completedRFPFeatures[0];
            areaProperties = completedRFPFeatures[0].properties;
          }
          //console.log(completedPlanningAreasFeatures[0]);
          //console.log(polygonArea.geometry.coordinates[0]);
          polygon = turf.polygon([polygonArea.geometry.coordinates[0]]);
          var options = { tolerance: 0.001, highQuality: false };
          //var simplified = turf.simplify(polygon, options);
          //console.log(polygon.geometry);
          var socrataPolygon = Terraformer.WKT.convert(polygon.geometry);
          //console.log(socrataPolygon);
          var center = turf.centroid(polygon);
          $(".map-sidebar-header, .occupancy-data, .key-data, .additional-data, .mcr-data, .mcm-data").empty();
          $("#map-sidebar-info .key-data").append(
            '<div id="public-ownership-count"><span>Public Ownership</span><p id="parks-count"></p><p id="city-owned-parcel-count"></p><p id="dlba-parcel-count"></p></div><div id="development-count"><span>Development</span><p id="bseed-residential-permits-count"></p><p id="bseed-commercial-permits-count"></p></div><div id="retail-count"><span>Retail</span><p id="mcm-open-business-count"></p><p id="mcm-restore-count"></p></div>'
          );

          if (
            snfAreasFeatures.length > 0 ||
            planningAreasFeatures.length > 0 ||
            completedPlanningAreasFeatures.length > 0 ||
            targetedMultiFamilyFeatures.length > 0
          ) {
            $.getJSON(
              "https://data.detroitmi.gov/resource/but4-ky7y.json?$where=within_polygon(site_location, " +
                encodeURI(JSON.stringify(socrataPolygon)) +
                ")%20AND%20permit_issued%3E%22" +
                permitDate +
                "%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22NON-RESIDENTIAL%22&$limit=50000",
              function(commercialPermits) {
                //console.log(commercialPermitsCount);
                commercialPermitsCount = '<span class="field-label">' + commercialPermits.length + "</span> Open BSEED Commercial Permits";
                $("#map-sidebar-info .key-data #bseed-commercial-permits-count").append(commercialPermitsCount);
              }
            );
            $.getJSON(
              "https://data.detroitmi.gov/resource/but4-ky7y.json?$where=within_polygon(site_location, " +
                encodeURI(JSON.stringify(socrataPolygon)) +
                ")%20AND%20permit_issued%3E%22" +
                permitDate +
                "%22%20AND%20permit_status=%22OPEN%22AND%20residential=%22RESIDENTIAL%22&$limit=50000",
              function(residentialPermits) {
                residentialPermitsCount = '<span class="field-label">' + residentialPermits.length + "</span> Open BSEED Residential Permits";
                $("#map-sidebar-info .key-data #bseed-residential-permits-count").append(residentialPermitsCount);
              }
            );
            $.getJSON(
              "https://data.detroitmi.gov/resource/pizv-bpt2.json?$where=within_polygon(the_geom, " + encodeURI(JSON.stringify(socrataPolygon)) + ")",
              function(parksCount) {
                parksCount = '<span class="field-label">' + parksCount.length + "</span> Parks";
                $("#map-sidebar-info .key-data #parks-count").append(parksCount);
              }
            );
            $.getJSON(
              "https://data.detroitmi.gov/resource/vsin-ur7i.json?$where=within_polygon(location, " +
                encodeURI(JSON.stringify(socrataPolygon)) +
                ")&$limit=50000",
              function(landBankStructureCount) {
                landBankStructureCount = '<span class="field-label">' + landBankStructureCount.length + "</span> Detroit Land Bank Parcels";
                $("#map-sidebar-info .key-data #dlba-parcel-count").append(landBankStructureCount);
              }
            );
            $.getJSON(
              "https://data.detroitmi.gov/resource/snut-x2sy.json?taxable_status=%27CITY%20OWNED%27&$where=within_polygon(location, " +
                encodeURI(JSON.stringify(socrataPolygon)) +
                ")&$limit=50000",
              function(cityOwnedParcelsCount) {
                cityOwnedParcelsCount = '<span class="field-label">' + cityOwnedParcelsCount.length + "</span> City-Owned Parcels";
                $("#map-sidebar-info .key-data #city-owned-parcel-count").append(cityOwnedParcelsCount);
              }
            );
            $.getJSON(
              "https://data.detroitmi.gov/resource/f3fy-ksxq.geojson?$where=within_polygon(location, " +
                encodeURI(JSON.stringify(socrataPolygon)) +
                ")&$limit=50000",
              function(mcrCount) {
                //console.log(mcrCount.features.length);
                mcrCount = '<span class="field-label">' + mcrCount.features.length + "</span> Motor City Re-Store Awardees";
                $("#map-sidebar-info .key-data #mcm-restore-count").append(mcrCount);
              }
            );
            $.getJSON(
              "https://data.detroitmi.gov/resource/ibmm-yi2w.geojson?$where=within_polygon(location, " +
                encodeURI(JSON.stringify(socrataPolygon)) +
                ")&$limit=50000",
              function(mcmBusinessCount) {
                //console.log(mcmBusinessCount.features.length);
                mcmBusinessCount = '<span class="field-label">' + mcmBusinessCount.features.length + "</span> Motor City Match Open Businesses";
                $("#map-sidebar-info .key-data #mcm-open-business-count").append(mcmBusinessCount);
              }
            );
            flyTo(center.geometry.coordinates[0], center.geometry.coordinates[1], 12.5);
          } else {
            flyTo(center.geometry.coordinates[0], center.geometry.coordinates[1], 15);
          }

          for (var field in areaProperties) {
            if (areaProperties.hasOwnProperty(field)) {
              if (field == "Descriptio" || field == "description") {
                projDesc = areaProperties[field];
              }
              if (field == "Entity" || field == "rfp_issuer") {
                projEntity = areaProperties[field];
              }
              if (field == "Image" || field == "image") {
                projImage = areaProperties[field];
                if (projImage && projImage.length > 1 && projImage != "null") {
                  //console.log(projImage);
                  projImage = '<div data-field="Photo_URL" class="frame project-image"><img alt="Photo of" src="' + projImage + '"/></div>';
                } else {
                  projImage = "https://detroitmi.gov/sites/detroitmi.localhost/files/styles/de2e/public/2018-11/detroit1.jpg";
                  projImage = '<div data-field="Photo_URL" class="frame project-image"><img alt="Photo of" src="' + projImage + '"/></div>';
                }
              }
              if (field == "Link" || field == "link") {
                projLink = areaProperties[field];
                if (projLink === "null") {
                  projLink = "";
                }
              }
              if (field == "MapStatus") {
                projMapStatus = areaProperties[field];
              }
              if (field == "Notes") {
                projNotes = areaProperties[field];
              }
              if (field == "Planning_1") {
                projPlanning_1 = areaProperties[field];
              }
              if (field == "Planning_A" || field == "development_team") {
                projPlanning_A = areaProperties[field];
              }
              if (field == "Proj_NAME" || field == "name") {
                projName = areaProperties[field];
              }
              if (field == "Project_St") {
                projSt = areaProperties[field];
              }
              if (field == "SNF") {
                projSNF = areaProperties[field];
                if (projSNF === "SNF") {
                  projSNF = "Strategic Neighborhood Fund";
                } else {
                  projSNF = "Planning Area";
                }
              }
              if (field == "Status" || field == "status_public") {
                projStatus = areaProperties[field];
              }
            }
          }

          if (snfAreasFeatures.length > 0 || planningAreasFeatures.length > 0 || completedPlanningAreasFeatures.length > 0) {
            projDesc =
              "The City of Detroit is mobilized to create a neighborhood strategy and implementation plan for the " +
              projName +
              " neighborhood with the help of community input and engagement lead by our City of Detroit planning team. We will hold extensive conversations with the community, leverage past planning and implementation work of neighborhood organizations in order to build a comprehensive and inclusive vision for the community";
            if (projLink && projLink.length > 1) {
              projLink =
                '<p class="project-description">To learn more about the planning study click here: <a target="_blank" href="' +
                projLink +
                '">' +
                projName +
                "</a></p>";
            } else {
              projLink =
                '<p class="project-description">To learn more, check out the <a href="http://detroitmi.gov/Government/Departments-and-Agencies/Planning-and-Development-Department" target="_blank">Planning Department</a>.</p>';
            }
            //console.log(projLink);
            projDesc = '<p class="project-description">' + projDesc + "<br><br></p>";
            $(".map-sidebar-header").text(projName);
            $("#map-sidebar-info .occupancy-data").append(projImage, projDesc);
            $("#map-sidebar-info .occupancy-data").append(
              '<p><span class="field-label">Project Status:</span> ' +
                projStatus +
                "</p>" +
                '<p><span class="field-label">Project Type:</span> ' +
                projSNF +
                "</p><br>" +
                projLink
            );
            $("#map-sidebar-info .key-data").prepend("<h5><span>AREA STATISTICS: </span></h5>");
            /*$('#map-sidebar-info .key-data').append(program_type, property_address, demolition_date, owner, owner_address, zoning, council_district);
                                        $('#map-sidebar-info .additional-data').append('<h5>Additional Data</h5>', last_sale_date, last_sale_price, year_built, parcelnum, sev, taxable_status, land_value, taxable_value, pre, total_acres, frontage, depth, sqft, ward, legaldesc);*/
          } else if (targetedMultiFamilyFeatures.length > 0) {
            projDesc =
              "The 2016 Targeted Multifamily Housing Areas map identifies areas of the city with stronger housing markets and active commercial corridors. It is the City's policy to prioritize investment in these areas, where increasing residential density will promote walkable urban neighborhoods with access to services, transit, and employment. <br> Developers of both market-rate and affordable housing, whether standalone or as part of a mixed-use development, are encouraged to focus in these areas.";
            projLink =
              '<p class="project-description">To learn more about multifamily housing click here: <a target="_blank" href="http://www.detroitmi.gov/Government/Departments-and-Agencies/Housing-and-Revitalization/For-Developers-and-Contractors#hrd_multifamily_housing">HRD Multi-Family Housing</a></p>';
            //console.log(residentialPermitsCount);
            $(".map-sidebar-header").text(projName);
            $("#map-sidebar-info .occupancy-data").append(projImage, projDesc);
            $("#map-sidebar-info .key-data").prepend("<h5><span>AREA STATISTICS: </span></h5>");
            $("#map-sidebar-info .additional-data").append("<br>" + projLink);
            /*$('#map-sidebar-info .key-data').append(program_type, property_address, demolition_date, owner, owner_address, zoning, council_district);
                                    $('#map-sidebar-info .additional-data').append('<h5>Additional Data</h5>', last_sale_date, last_sale_price, year_built, parcelnum, sev, taxable_status, land_value, taxable_value, pre, total_acres, frontage, depth, sqft, ward, legaldesc);*/
          } else {
            if (projLink && projLink.length > 1) {
              projLink = '<p class="project-description">To learn more, check out: <a target="_blank" href="' + projLink + '">' + projName + "</a></p>";
            }
            projPlanning_1 =
              "Both the City of Detroit and Detroit Economic Growth Corporation release Request for Proposals (RFPs) to support development investment in the City.";
            projDesc = '<p class="project-description">' + projDesc + "</p>";
            $(".map-sidebar-header").text(projName);
            $("#map-sidebar-info .occupancy-data").append(projImage, "<p>" + projPlanning_1 + "</p>");
            $("#map-sidebar-info .key-data")
              .empty()
              .prepend("<h5><span>RFP DETAILS: </span></h5>");
            if (projName != "null") {
              $("#map-sidebar-info .key-data").append('<p><span class="field-label">Project Name: </span>' + projName + "</p>");
            }
            if (projStatus != "null") {
              $("#map-sidebar-info .key-data").append('<p><span class="field-label">Status: </span>' + projStatus + "</p>");
            }
            if (projPlanning_A != "null") {
              $("#map-sidebar-info .key-data").append('<p><span class="field-label">Development Team: </span>' + projPlanning_A + "</p>");
            }
            if (projEntity != "null") {
              $("#map-sidebar-info .key-data").append('<p><span class="field-label">RFP Issuer: </span>' + projEntity + "</p><br>");
            }
            $("#map-sidebar-info .additional-data").append(projDesc + "<br>" + projLink);
          }

          function hideLoadScreen() {
            $("#loadscreen").hide();
            $("#map-sidebar-info").show();
          }
          hideLoadScreen();
        } else if (
          residentialPermitFeatures.length > 0 ||
          oneMillionPermitFeatures.length > 0 ||
          twentyFiveMillionPermitFeatures.length > 0 /*||overTwentyFiveMillionPermitFeatures.length>0*/
        ) {
          var permitParcelParam;
          if (oneMillionPermitFeatures.length > 0) {
            var permits = [];
            for (var i = 0; i < oneMillionPermitFeatures.length; i++) {
              permits.push(oneMillionPermitFeatures[i].properties);
              permitParcelParam = permits[i].parcel_no;
            }
          } else if (residentialPermitFeatures.length > 0) {
            var permits = [];
            for (var i = 0; i < residentialPermitFeatures.length; i++) {
              permits.push(residentialPermitFeatures[i].properties);
              permitParcelParam = permits[i].parcel_no;
            }
          } else if (twentyFiveMillionPermitFeatures.length > 0) {
            var permits = [];
            for (var i = 0; i < twentyFiveMillionPermitFeatures.length; i++) {
              permits.push(twentyFiveMillionPermitFeatures[i].properties);
              permitParcelParam = permits[i].parcel_no;
            }
          } /*
                                    else if(overTwentyFiveMillionPermitFeatures.length>0){
                                    var permits =[];
                                        for (var i = overTwentyFiveMillionPermitFeatures.length; i >= 0; i--) {
                                            permits.push(overTwentyFiveMillionPermitFeatures[i]);
                                            permitParcel = overTwentyFiveMillionPermitFeatures[i].properties.parcel_no;
                                        }
                                       
                                    }*/
          //console.log(permits);

          getParcelInfo(permitParcelParam);
        } else if (marketedPropFeatures.length > 0 || taxStatusCityFeatures.length > 0) {
          if (marketedPropFeatures.length > 0) {
            if (marketedPropFeatures[0].properties.pid !== "null") {
              getParcelInfo(marketedPropFeatures[0].properties.pid);
              flyTo(marketedPropFeatures[0].geometry.coordinates[0], marketedPropFeatures[0].geometry.coordinates[1], 16);
            }
          } else if (taxStatusCityFeatures.length > 0) {
            getParcelInfo(taxStatusCityFeatures[0].properties.parcelnum);
            flyTo(taxStatusCityFeatures[0].geometry.coordinates[0], taxStatusCityFeatures[0].geometry.coordinates[1], 16);
          }
        } else if ($("#map-sidebar-info .map-sidebar-header").val() !== "DETROIT") {
          //console.log($('#map-sidebar-info .map-sidebar-header').text());
          getCitywideStats();
          $("#loadscreen").hide();
          $("#map-sidebar-info").show();
        }

        $(".permit-data").hide();
      }
    });
    function flyTo(pointLng, pointLat, zoomlevel) {
      map.flyTo({
        center: [pointLng, pointLat],
        zoom: zoomlevel,
        bearing: 0,
        speed: 2,
        curve: 1,
        easing: function(t) {
          return t;
        }
      });
    }
    /*map.on("mouseenter", "residential-permits", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "residential-permits", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "one-million", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "one-million", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "twenty-five-million", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "twenty-five-million", function() {
      map.getCanvas().style.cursor = "";
    });*/
    map.on("mouseenter", "mc-restore", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "mc-restore", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "mcm-business", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "mcm-business", function() {
      map.getCanvas().style.cursor = "";
    });/*
    map.on("mouseenter", "marketed-properties", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "marketed-properties", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "tax-status-city-owned-properties", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "tax-status-city-owned-properties", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "in-construction-rfp-fill", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "in-construction-rfp-fill", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "open-rfp-fill", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "open-rfp-fill", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "predevelopment-rfp-fill", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "predevelopment-rfp-fill", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "completed-rfp-fill", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "completed-rfp-fill", function() {
      map.getCanvas().style.cursor = "";
    });
    map.on("mouseenter", "targeted-multi-family-fill", function() {
      map.getCanvas().style.cursor = "pointer";
    });
    // Change it back to a pointer when it leaves.
    map.on("mouseleave", "targeted-multi-family-fill", function() {
      map.getCanvas().style.cursor = "";
    });*/
    /*map.on('mouseenter', 'over-twenty-five-million', function () {
                            map.getCanvas().style.cursor = 'pointer';
                        });
                        // Change it back to a pointer when it leaves.
                        map.on('mouseleave', 'over-twenty-five-million', function () {
                            map.getCanvas().style.cursor = '';
                        });*/
  })(window);
</script>
